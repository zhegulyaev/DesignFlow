:root{
    --bg:#0d1117;--card:#161b22;--card-alt:#0f141b;--text:#c9d1d9;--muted:#8b949e;--accent:#58a6ff;--green:#2ea043;--red:#da3633;
    --gold:#d29922;--border:#30363d;--blue:#238636;--btn-blue:#2f81f7;--link-blue:#007bff;--purple:#a371f7;--btn-hover:#30363d;
    --button-bg:#21262d;--row-hover:#1c2128;--table-border:#21262d;--input-bg:#21262d;--chart-bar-bg:#21262d;--date-hover-bg:#161b22;
    --date-hover-border:#3a3f4b;--tab-hover:#30363d;--pill-bg:#1a1f26;--chip-bg:#121720;--link-go-bg:#1a1f26;--modal-overlay:rgba(0,0,0,0.7);
    --date-focus-bg:#111722;--help-bg:#121720;--help-hover-bg:#1c2128;--help-border:rgba(255,255,255,0.12);--help-text:var(--muted);
    --del-hover-bg:#1c2128;--del-hover-border:var(--border);
    --progress-bg:linear-gradient(90deg,#11151c,#0b1017);
    --progress-border:rgba(88,166,255,0.2);
    --progress-shadow:inset 0 1px 0 rgba(255,255,255,0.04),0 0 0 1px rgba(15,20,27,0.65);
    --progress-fill-start:#2ea043;
    --progress-fill-end:#3fb950;
    --progress-fill-shadow:0 0 14px rgba(46,160,67,0.3);
    --record-bg:linear-gradient(90deg,#1c2128,#11151c);
    --record-border:rgba(250,204,21,0.25);
    --record-shadow:inset 0 1px 0 rgba(255,255,255,0.03);
    --record-fill-start:#facc15;
    --record-fill-end:#f9a825;
    --record-fill-shadow:0 0 12px rgba(250,204,21,0.4);
    --goal-pill-bg:linear-gradient(120deg,rgba(88,166,255,0.22),rgba(163,113,247,0.22));
    --goal-pill-border:rgba(163,113,247,0.4);
    --goal-pill-color:#dce7ff;
    --efficiency-potential: rgba(88,166,255,0.32);
    --goal-pill-shadow:0 4px 18px rgba(88,166,255,0.22);
    --status-bg:var(--pill-bg);
    --status-border:var(--border);
    --status-text:var(--muted);
  }
  body.light{
    --bg:#f8fbff;--card:#ffffff;--card-alt:#f4f7fb;--text:#1f2937;--muted:#56657d;--accent:#3b82f6;--green:#22b46d;--red:#de3f57;
    --gold:#c48b2e;--border:#d8e1f0;--blue:#3b82f6;--btn-blue:#3b82f6;--link-blue:#3b82f6;--purple:#7c52e4;--btn-hover:#eaf1ff;
    --button-bg:#f2f6fd;--row-hover:#f5f8ff;--table-border:#e4ebf7;--input-bg:#f6f8fd;--chart-bar-bg:#e9f0fb;--date-hover-bg:#eef3ff;
    --date-hover-border:#d4dff5;--tab-hover:#eef3ff;--pill-bg:#f1f5fd;--chip-bg:#f1f5fd;--link-go-bg:#e8f0ff;--modal-overlay:rgba(0,0,0,0.35);
    --date-focus-bg:#e1e9ff;--help-bg:#e8f0ff;--help-hover-bg:#dfe8ff;--help-border:#cbd8f1;--help-text:#43526b;
    --del-hover-bg:#fde8e8;--del-hover-border:#f3c5c5;
    --progress-bg:linear-gradient(90deg,#eef3ff,#f8fbff);
    --progress-border:#d5dff0;
    --progress-shadow:inset 0 1px 0 rgba(255,255,255,0.92),0 0 0 1px rgba(213,223,240,0.65);
    --progress-fill-start:#26c06d;
    --progress-fill-end:#35d691;
    --progress-fill-shadow:0 0 12px rgba(53,214,145,0.28);
    --record-bg:linear-gradient(90deg,#fff7e3,#fffaf1);
    --record-border:#f3dfb5;
    --record-shadow:inset 0 1px 0 rgba(255,255,255,0.95);
    --record-fill-start:#f6b21a;
    --record-fill-end:#ffd45c;
    --record-fill-shadow:0 0 12px rgba(255,212,92,0.4);
    --goal-pill-bg:linear-gradient(120deg,#e7f0ff,#f3e9ff);
    --goal-pill-border:#d3ddf5;
    --goal-pill-color:#1f3158;
    --goal-pill-shadow:0 6px 18px rgba(137,170,255,0.26);
    --status-bg:#f6f8fd;
    --status-border:#e2e8f5;
    --status-text:#1f2d45;
    --efficiency-potential: rgba(59,130,246,0.22);
  }
  body.light .reputation-card { background: #fff; box-shadow: 0 8px 26px rgba(17,24,39,0.04); border-color: #e0e7f5; }
  body.light .record-motiv { color: #1f2937; }
  body.light .reputation-strip { background: linear-gradient(90deg, rgba(34, 180, 109, 0.08), rgba(210, 153, 34, 0.06)); box-shadow: none; }
  *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;}

  /* Minimal scrollbars — appear only while scrolling */
  * { scrollbar-width: thin; scrollbar-color: rgba(139,148,158,0.6) transparent; }
  *::-webkit-scrollbar { width: 9px; height: 9px; background: transparent; }
  *::-webkit-scrollbar-thumb { background-color: transparent; border-radius: 10px; border: 2px solid transparent; }
  *::-webkit-scrollbar-track { background: transparent; }
  .show-scrollbars *::-webkit-scrollbar-thumb { background-color: rgba(139,148,158,0.65); }
  .show-scrollbars *::-webkit-scrollbar-thumb:hover { background-color: rgba(88,166,255,0.75); }
  .show-scrollbars { scrollbar-color: rgba(139,148,158,0.6) transparent; }
  
  body{background:var(--bg);color:var(--text);padding-bottom:100px;min-height:100vh;display:flex;flex-direction:column;}
  .c{max-width:1600px;margin:0 auto;padding:20px;width:100%;} 
  
  /* Header */
  h1{font-size:42px;font-weight:800;margin:0;letter-spacing: -1px;}
  .brand-grad { background:linear-gradient(90deg,#58a6ff,#a371f7,#d29922);-webkit-background-clip:text;-webkit-text-fill-color:transparent; }
  .brand-white { color: var(--muted); font-weight: 400; letter-spacing: -0.4px; }
  
  /* Исправлен отступ в шапке */
  .header-row{display:flex;justify-content:space-between;align-items:center;margin:20px 0 16px; gap: 16px; padding: 12px 18px; border-radius: 16px; background: transparent; border: none; box-shadow: none;}
  .brand-wrap { display: flex; align-items: center; gap: 12px; }
  .brand-logo { width: 44px; height: 44px; border-radius: 14px; display: grid; place-items: center; background: #7c52e4; border: 2px solid rgba(255,255,255,0.18); font-size: 22px; color: #f5f1ff; font-weight: 900; box-shadow: 0 10px 28px rgba(124,82,228,0.35); }
  .brand-text { display: flex; flex-direction: column; line-height: 1.05; }
  .brand-title { display: flex; align-items: baseline; gap: 8px; font-size: 30px; font-weight: 900; letter-spacing: -0.8px; color: #7c52e4; }
  .brand-version { font-size: 14px; font-weight: 800; color: #9aa3b8; letter-spacing: -0.3px; }
  .brand-sub { font-size: 14px; color: var(--muted); font-weight: 700; }
  .month-select{background:var(--card);color:var(--text);border:1px solid var(--border);padding:8px 15px;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;outline:none;transition:.2s;}
  .month-select:hover{border-color:var(--muted);}

  #themeToggle { padding:10px 20px; gap:10px; min-height: 44px; }
  #themeToggleIcon { font-size: 16px; }
  #themeToggleLabel { font-weight: 700; font-size: 13px; }
  .btn-icon { width: 16px; height: 16px; }
  .btn-icon.lg { width: 18px; height: 18px; }
  .btn-label { font-weight: 700; letter-spacing: -0.1px; }


      .date-cell:not(:last-child) .date-input-wrap {
    margin-right: 8px;
}

  /* Warning Block */
  .top-panel{background:var(--card);padding:16px 18px;border-radius:14px;border:1px solid var(--border);margin-bottom:30px;display:flex;align-items:center;flex-wrap:wrap;gap:16px;box-shadow:none;}
  .backup-alert{display:flex;align-items:center;gap:12px;flex:1;min-width:280px;}
  .backup-icon{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:rgba(248,81,73,0.12);border:1px solid rgba(248,81,73,0.45);color:#f85149;box-shadow:0 8px 20px rgba(0,0,0,0.08);}
  .backup-icon svg{width:18px;height:18px;}
  .backup-info{color:var(--muted);font-size:13px;line-height:1.5;display:flex;flex-direction:column;gap:4px;}
  .backup-info b{color:#f85149;}
  .backup-info .backup-title{font-weight:800;letter-spacing:-0.15px;color:var(--text);}
  .backup-info .backup-sub{max-width:640px;}
  
  .btns{display:flex;gap:15px;flex-wrap:wrap; align-items: center;} 
  
  button{padding:10px 20px;background:var(--button-bg);border:1px solid var(--border);color:var(--text);border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;transition:.2s;display:flex;align-items:center;gap:8px;white-space: normal;}
  button:hover{border-color:var(--accent);color:var(--accent);}
  .confirm-del-btn { color: #fff; font-weight: 800; }
  .confirm-del-btn:hover { color: #fff; }

  .toast { position: fixed; top: 15px; right: 20px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 12px 16px; display: none; align-items: center; gap: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 1200; min-width: 260px; }
  .toast.show { display: flex; animation: fadeIn .2s ease; }
  .toast-message { flex: 1; font-weight: 600; color: var(--text); }
  .toast-action { background: var(--btn-blue); color: #fff; border: 1px solid var(--btn-blue); border-radius: 6px; padding: 6px 10px; font-weight: 700; cursor: pointer; }
  .toast-close { background: transparent; border: none; color: var(--muted); cursor: pointer; font-size: 16px; padding: 0 4px; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
  
  /* Tabs */
  .tabs-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  .tabs{display:flex;gap:10px;overflow-x: auto; padding-bottom: 5px; flex-shrink: 1;}
  .tab{flex-shrink: 0; padding:8px 14px;border-radius:10px;cursor:pointer;font-size:15px; background:transparent;border:1px solid transparent;transition:.2s; font-weight: 600; color:var(--muted); display: flex; align-items: center; gap: 8px; letter-spacing: -0.2px;}
  .tab svg { width: 14px; height: 14px; opacity: 0.7; transition: opacity .2s; }
  .tab:hover{background:var(--tab-hover);border-color:var(--tab-hover);color:var(--text);}
  .tab.active{background:var(--card); border-color:var(--border); font-weight: 700; color: var(--text) !important;}
  .tab.active svg { opacity: 1; color: var(--text); }
  .tab.tab-trash { margin-left: auto; }
  .tab-count { min-width: 22px; height: 22px; border-radius: 8px; background: var(--button-bg); border: 1px solid var(--border); display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 800; color: var(--muted); padding: 0 6px; }
  .tab.active .tab-count { background: var(--accent); border-color: var(--accent); color: #fff; }

  /* New Project Button (Notion Style) */
  #newProjectButton { background: var(--btn-blue); color: #fff; border: 1px solid var(--btn-blue); font-weight: 700; padding: 8px 16px; margin-left: 20px;}
  #newProjectButton:hover { background: #3c82f6; border-color: #3c82f6; color: #fff; }

  /* Tab Description - Увеличен отступ перед Pace Block */
  .tab-desc-block { margin-bottom: 15px; } 

  /* Main Layout & Tables */
  .table-wrap{overflow:visible;background:var(--card);border-radius:12px;border:1px solid var(--border);padding:5px 12px 5px 18px; margin-top: 10px; position: relative;}
  table{width:100%;border-collapse:collapse; min-width: 1380px;}
  th{text-align:left;color:var(--muted);font-size:12px;text-transform:uppercase;padding:11px 8px;border-bottom:1px solid var(--border);user-select:none; white-space: nowrap; cursor: pointer;}
  
  /* Выравнивание заголовков для Active */
  #t-active th:nth-child(8), /* Расходы */
  #t-active th:nth-child(9), /* Сумма */
  #t-active th:nth-child(10) { /* Чистыми */
      text-align: right;
  }
  #t-active th:nth-child(6),
  #t-active td:nth-child(6) { text-align: center; }

  th:first-child, td:first-child { width: 24px; cursor: default; text-align: center; }
  td.select-col { position: relative; }
  td{ padding: 10px 8px; border-bottom:1px solid var(--table-border); vertical-align:middle; font-size:15px; position: relative; }
  tr:last-child td{border-bottom:none;}
  tr:hover td{background:var(--row-hover);}

  tr { position: relative; }

  /* Checkbox column */
  th.select-col { width: 5%; cursor: default; }
  td.select-col { width: 5%; padding: 0; text-align: center; }
  
  /* Контейнер для чекбокса и иконки дублирования - для выравнивания */
  .select-action-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      height: 100%;
      padding: 0 5px;
  }
  .bulk-checkbox { width: 16px; height: 16px; margin: 0; cursor: pointer; background: transparent; border: 1px solid var(--muted); border-radius: 4px; appearance: none; transition: background .1s, border-color .1s; flex-shrink: 0;}
  .bulk-checkbox:checked { background: var(--accent); border-color: var(--accent); }

  /* Table Footer (Totals) */
  tfoot td { padding: 16px 10px; border-top: 2px solid var(--border); background: var(--card-alt); font-weight: 700; color: var(--muted); text-align: right; font-size: 14px; white-space: nowrap; }
  tfoot td:first-child { text-align: left; color: var(--text); font-size: 15px; }
  tfoot td:nth-last-child(3) { color: var(--gold); } /* Total gross (Archive) */
  tfoot td:nth-last-child(2) { color: var(--green); } /* Total net (Archive) */
  /* Active table footer fix */
  #total-row-active td:nth-child(2) { color: var(--green); } /* Total net (Active) */
  .footer-total-toggle { cursor: pointer; color: var(--accent); font-weight: 700; }
  .footer-total-toggle:hover { color: #8ab4ff; }

  
  /* Inputs & Selects */
  [contenteditable]{ outline:none; background: transparent; border: 1px solid transparent; padding: 5px 8px; border-radius: 6px; transition:.2s; display:inline-block; width: 100%; white-space: pre-wrap; word-break: break-word; overflow: visible; text-overflow: unset; }
  [contenteditable]:focus, [contenteditable]:hover { border-color: var(--border); background: var(--input-bg); cursor: text; }
  [contenteditable]:focus { white-space: pre-wrap; -webkit-line-clamp: initial; overflow: visible; text-overflow: unset; }
  
  .date-cell { padding: 0 !important; } 
  .date-input-wrap { width: 100%; padding: 6px 8px; cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: flex-start; transition: .2s; border-radius: 10px; gap: 6px; border: 1px solid var(--border); background: transparent; box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); }
  .date-input-wrap:hover { background: var(--date-hover-bg); border-color: var(--date-hover-border); }
  .date-text-display { font-size: 14px; font-weight: 600; color: var(--text); white-space: nowrap; display: inline-flex; align-items: center; gap: 8px; letter-spacing: -0.1px; }
  .date-icon { display: inline-flex; width: 14px; height: 14px; color: var(--muted); opacity: 0.85; }
  .time-text { color: var(--muted); font-weight: 700; font-size: 12px; }
  .deadline-warning-icon { color: var(--red); font-size: 12px; margin-left: 6px; cursor: help; opacity: 0.9; }
  .deadline-success-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 800;
    color: var(--green);
    background: rgba(46,160,67,0.12);
    border: 1px solid rgba(46,160,67,0.35);
    margin-left: 6px;
    white-space: nowrap;
  }
  .deadline-success-badge .time-text { margin-left: 6px; }

  /* All-projects tweaks */
  #t-all .date-cell { padding: 8px 8px !important; }
  #t-all .date-input-wrap { width: auto; display: inline-flex; min-width: 148px; }
  #t-all .price-cell-wrap input { min-width: 110px; max-width: 150px; }
  #t-all th:nth-child(6), #t-all td:nth-child(6) { min-width: 180px; }
  #t-all td.actions-cell { text-align: left; }
  #t-all td.actions-cell .link-btn { margin-left: 0; }

  /* Archive tweaks */
  #t-archive .date-input-wrap { width: auto; display: inline-flex; min-width: 136px; }
  #t-archive th:nth-child(5), #t-archive th:nth-child(6), #t-archive th:nth-child(7),
  #t-archive td:nth-child(5), #t-archive td:nth-child(6), #t-archive td:nth-child(7) { text-align: right; }
  #t-archive .archive-date-cell { padding: 8px 8px !important; }
  #t-archive .archive-date-cell .deadline-block { display: grid; gap: 6px; }
  #t-archive .deadline-row { display: flex; align-items: center; gap: 8px; }
  #t-archive .deadline-label { font-size: 12px; font-weight: 700; color: var(--muted); min-width: 66px; }
  #t-archive .deadline-value { display: inline-flex; align-items: center; gap: 6px; font-weight: 700; }
  #t-archive .deadline-value .date-text-display { padding: 2px 0; }
  #t-archive .deadline-value.muted { color: var(--muted); }

  /* Deadline Colors */
  .days-critical { color: var(--red); font-weight: 700; }
  .days-warning { color: var(--gold); font-weight: 700; }
  .days-normal { color: var(--muted); }
  .days-infinite { color: var(--muted); font-weight: 800; display: inline-flex; align-items: center; gap: 6px; }
  .deadline-infinity { color: var(--muted); font-weight: 800; display: inline-flex; align-items: center; gap: 6px; }
  
  /* Price/Contractor/Net Styling */
  .price-cell-wrap { display: flex; align-items: center; justify-content: flex-end; gap: 4px; height: 100%; padding: 2px 0;}
  .price-cell-wrap input {
    background: transparent;
    border: none;
    color: var(--text);
    width: 100%;
    max-width: 110px;
    min-width: 64px;
    flex: 1 1 70px;
    font-family: monospace;
    font-weight: 600;
    outline: none;
    text-align: right;
    padding: 4px 0; /* Добавлен отступ для кликабельности */
    margin: 0;
    -moz-appearance: textfield;
  }
  .price-cell-wrap:focus-within { border-color: var(--border); background: var(--input-bg); border-radius: 6px; }
  .price-cell-wrap input::-webkit-outer-spin-button, .price-cell-wrap input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .currency-symbol { color: var(--muted); font-size: 14px; font-weight: 600; font-family: monospace; min-width: 15px; }
  .currency-symbol.symbol-empty { font-size: 12px; font-weight: 800; color: var(--muted); text-transform: lowercase; }

  /* Net Column Fix */
  .net-display-wrap { display: flex; flex-direction: column; align-items: flex-end; padding: 5px 0; }
  .net-main-val { font-weight: 600; color: var(--text); }
  .net-prc-val {
      font-size: 12px;
      font-weight: 500; /* Не жирный */
      opacity: 0.6; /* Полупрозрачность */
      color: var(--muted);
      margin-top: 2px;
  }

  .expense-cell { gap: 4px; }
  .expense-mode { background: var(--pill-bg); color: var(--text); border: 1px solid var(--border); border-radius: 6px; padding: 4px 6px; font-size: 12px; cursor: pointer; min-width: 54px; }
  .expense-helper { color: var(--muted); font-size: 11px; margin-top: 2px; text-align: right; line-height: 1.2; }

  .paid-amount { font-size: 12px; color: var(--muted); margin-top: 4px; text-align: right; }

  .paid-cell { text-align: right; }
  .paid-cell .paid-select { margin-left: auto; display: inline-flex; }
  .paid-cell .paid-amount { text-align: right; width: 100%; }


  .paid-select, .tax-select { background: transparent; color: var(--text); border: 1px solid transparent; padding: 5px; border-radius: 6px; font-size: 13px; cursor: pointer; outline: none; transition: .2s; text-align: center;}
  .paid-select:hover, .tax-select:hover { background: var(--btn-hover); border-color: var(--border); }
  .paid-select option, .tax-select option { background: var(--card); }

  /* Actions */
  .client-wrap{display:flex;align-items:center;gap:8px; width: 100%; min-height: 48px;}
  .client-name, .project-name { display:block; line-height:1.45; white-space:pre-wrap; -webkit-line-clamp:unset; -webkit-box-orient:vertical; overflow:visible; text-overflow:unset; word-break: break-word; padding: 4px 0; }
  .client-name { max-width: 210px; font-weight:700; color:var(--text); }
  .project-name-wrap { display: flex; align-items: center; gap: 8px; overflow: visible; min-height: 52px; }
  .project-name { max-width: 320px; font-weight:600; padding: 10px 0; min-height: 56px; display: block; }

  .sort-icon { color: var(--muted); font-size: 11px; margin-left: 6px; opacity: 0.5; }
  th.sorted .sort-icon { opacity: 1; color: var(--text); }
  th.sorted.asc .sort-icon::after { content: '↑'; }
  th.sorted.desc .sort-icon::after { content: '↓'; }
  th .sort-icon::after { content: '↕'; }
  
  .dup-icon { opacity: 0; transition: opacity 0.2s; cursor: pointer; color: var(--muted); width: 16px; height: 16px; flex-shrink: 0;}
  tr:hover .dup-icon { opacity: 1; }

  .select-col { position: relative; min-width: 44px; }
  .row-index { color: var(--muted); font-weight: 700; font-size: 12px; text-align: center; }
  .row-selected .row-index { color: var(--text); }

  .row-controls { position:absolute; left:-28px; top:50%; transform:translate(-140%,-50%); display:flex; gap:10px; align-items:center; opacity:0; transition:opacity .2s; }
  tr:hover .row-controls, .row-selected .row-controls { opacity:1; }
  .row-controls .bulk-checkbox { width: 18px; height: 18px; }
  .row-selected td { background: var(--row-hover); }

  .client-name.has-link { color: var(--link-blue); font-weight: 700; }


  .action-btns{display:flex;gap:6px;align-items:center;}
  .action-btn-base { padding: 6px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; font-weight: 700; cursor: pointer; user-select: none; min-width: 32px; text-align: center; }
  .done-btn:hover { background: var(--green); color: #fff; border-color: var(--green);}
  .edit-active-btn:hover { background: var(--accent); color: #fff; border-color: var(--accent); }
  .wait-btn:hover { background: var(--purple); color: #fff; border-color: var(--purple);}
  .pause-btn:hover { background: var(--link-blue); color: #fff; border-color: var(--link-blue);}
  /* New hover styles for wait and pause in active table */
  .wait-active-btn:hover { background: var(--purple); color: #fff; border-color: var(--purple);}
  .pause-active-btn:hover { background: var(--link-blue); color: #fff; border-color: var(--link-blue);}

  .link-btn { padding: 6px; margin: 0; background: var(--chip-bg); border: 1px solid var(--border); color: var(--muted); cursor: pointer; font-size: 12px; flex-shrink: 0; border-radius: 8px; transition: .2s; box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); display: inline-flex; align-items: center; justify-content: center; gap: 6px; }
  .link-btn svg { width: 14px; height: 14px; }
  .link-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--link-go-bg); box-shadow: 0 4px 10px rgba(59,130,246,0.12); }
  .link-btn-active { color: var(--accent); border-color: var(--border); background: var(--link-go-bg); border-radius: 8px; box-shadow: 0 4px 12px rgba(17,24,39,0.08); }
  .link-btn-go { border: 1px solid var(--border); border-radius: 8px; background: var(--link-go-bg); color: var(--accent); font-weight: 700; box-shadow: 0 4px 12px rgba(17,24,39,0.06); }
  .link-btn-go:hover { border-color: var(--accent); color: var(--accent); background: #f0f4ff; box-shadow: 0 6px 16px rgba(59,130,246,0.18); }
  .client-wrap .link-btn { opacity: 0; pointer-events: none; }
  tr:hover .client-wrap .link-btn, .row-selected .client-wrap .link-btn { opacity: 1; pointer-events: auto; }
  
  .del-btn{color:var(--text);cursor:pointer;opacity:0.7; margin-left: 8px; flex-shrink: 0; display: inline-flex; align-items: center; justify-content: center; padding: 6px; border: 1px solid transparent; border-radius: 8px; transition: .2s; background: transparent;}
  .del-btn svg { width: 16px; height: 16px; }
  .del-btn:hover{opacity:1; border-color: var(--del-hover-border); background: var(--del-hover-bg); color: var(--red);}
  
  /* --- Modern Pace Block (Темп недели) --- */
  .pace-block {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 6px; /* Тонкая рамка вокруг контента */
    margin-bottom: 24px;
    margin-top: 20px;
    display: flex;
    gap: 0;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.03);
    transition: all 0.3s ease;
  }
  
  /* Статус "Критично" меняет обводку и фон */
  .pace-block.critical {
    border-color: rgba(248,81,73,0.4);
    background: linear-gradient(to right, rgba(248,81,73,0.05), var(--card) 40%);
  }

  .pace-layout {
    display: flex;
    width: 100%;
    align-items: stretch;
    background: var(--card-alt);
    border-radius: 12px;
    overflow: hidden;
  }
  
  /* Левая часть - Основной статус */
  .pace-main {
    flex: 1;
    display: flex;
    align-items: center;
    padding: 16px 24px;
    gap: 18px;
    border-right: 1px solid var(--border);
    position: relative;
  }
  
  .pace-icon-box {
    width: 48px;
    height: 48px;
    border-radius: 14px;
    background: var(--card);
    border: 1px solid var(--border);
    display: grid;
    place-items: center;
    font-size: 24px;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }
  
  .pace-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  
  .pace-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: 800;
    color: var(--muted);
  }
  
  .pace-title-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .pace-title {
    font-size: 18px;
    font-weight: 800;
    color: var(--text);
  }
  
  .pace-status {
    font-size: 11px;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .pace-chill { background: rgba(46,160,67,0.15); color: var(--green); }
  .pace-hurry { background: rgba(248,81,73,0.15); color: var(--red); }
  
  .pace-desc {
    font-size: 13px;
    color: var(--muted);
    font-weight: 500;
  }

  /* Правая часть - Мини репутация */
  .pace-side {
    display: flex;
    align-items: center;
    padding: 0 24px;
    gap: 20px;
    background: rgba(255,255,255,0.01);
  }

  .pace-mini-stat {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    text-align: right;
  }
  
  .pace-rep-val {
    font-size: 20px;
    font-weight: 900;
    font-variant-numeric: tabular-nums;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .rep-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
  }
  .rep-dot.good { background: #2ea043; box-shadow: 0 0 0 2px rgba(46,160,67,0.2); }
  .rep-dot.warn { background: #d29922; box-shadow: 0 0 0 2px rgba(210,153,34,0.2); }
  .rep-dot.bad { background: #f85149; box-shadow: 0 0 0 2px rgba(248,81,73,0.2); }

  .pace-rep-sub {
    font-size: 12px;
    color: var(--muted);
    font-weight: 600;
  }
  
  .pace-btn-wrap button {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--muted);
    display: grid;
    place-items: center;
    cursor: pointer;
    transition: .2s;
  }
  .pace-btn-wrap button:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--button-bg);
  }

  @media(max-width: 768px) {
    .pace-layout { flex-direction: column; }
    .pace-main { border-right: none; border-bottom: 1px solid var(--border); }
    .pace-side { padding: 16px 24px; justify-content: space-between; }
    .pace-mini-stat { align-items: flex-start; text-align: left; }
  }

  /* --- Modern Reputation Block (Репутация) --- */
  .reputation-card {
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 0;
    background: var(--card);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  
  /* Шапка репутации */
  .rep-header-modern {
    padding: 24px;
    background: linear-gradient(180deg, var(--card-alt) 0%, var(--card) 100%);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  
  .rep-main-score {
    display: flex;
    align-items: center;
    gap: 16px;
  }
  
  .rep-badge-large {
    width: 64px;
    height: 64px;
    border-radius: 20px;
    background: var(--card);
    border: 1px solid var(--border);
    display: grid;
    place-items: center;
    font-size: 28px;
    color: var(--gold);
    box-shadow: 0 8px 24px rgba(0,0,0,0.06);
  }
  
  .rep-header-texts h3 {
    font-size: 32px;
    font-weight: 900;
    margin: 0;
    line-height: 1;
    letter-spacing: -1px;
    color: var(--text);
  }
  
  .rep-header-texts .rep-subtitle {
    font-size: 14px;
    color: var(--muted);
    margin-top: 6px;
    font-weight: 600;
  }

  .rep-status-badge {
    padding: 6px 12px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid transparent;
  }
  .rep-status-badge.good { background: rgba(46,160,67,0.1); color: var(--green); border-color: rgba(46,160,67,0.2); }
  .rep-status-badge.warn { background: rgba(210,153,34,0.1); color: var(--gold); border-color: rgba(210,153,34,0.2); }
  .rep-status-badge.bad { background: rgba(248,81,73,0.1); color: var(--red); border-color: rgba(248,81,73,0.2); }

  /* Сетка метрик */
  .rep-metrics-modern {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px;
    padding: 18px 20px;
    background: var(--card);
    border-bottom: 1px solid var(--border);
  }

  .rep-metric-item {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 14px;
    background: var(--card-alt);
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .rm-label {
    font-size: 12px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    font-weight: 800;
  }

  .rm-value {
    font-size: 22px;
    font-weight: 900;
    color: var(--text);
  }

  .rm-sub {
    font-size: 12px;
    color: var(--muted);
    font-weight: 600;
  }

  /* Основное тело: график + советы */
  .rep-body-split {
    display: grid;
    grid-template-columns: 1.4fr 1fr;
    gap: 0;
  }

  .rep-chart-area {
    padding: 20px;
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: center;
  }

  .rep-legend-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    font-size: 12px;
    font-weight: 700;
    color: var(--muted);
  }

  .rep-legend-pill {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: var(--card-alt);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
  }

  .rep-legend-pill .rep-dot { box-shadow: 0 0 0 3px rgba(255,255,255,0.06); }

  .rep-legend-text { display: flex; flex-direction: column; line-height: 1.1; gap: 2px; }
  .rep-legend-count { font-weight: 800; color: var(--text); font-size: 14px; }
  .rep-legend-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; color: var(--muted); }

  .rep-advice-area {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    background: var(--card);
  }

  .rep-fallout-banner {
    border: 1px dashed rgba(248,81,73,0.5);
    background: rgba(248,81,73,0.08);
    color: var(--red);
    padding: 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 700;
    display: none;
  }

  .rep-advice-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 2px;
  }

  .rep-chart-area canvas {
    width: 100% !important;
    max-width: 280px;
    aspect-ratio: 1 / 1;
    height: auto !important;
  }

  .rep-tip-card {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 12px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
    background: var(--card-alt);
    font-size: 13px;
    color: var(--muted);
    line-height: 1.45;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
  }

  #reputation-tips {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .rep-tip-card svg {
    width: 18px;
    height: 18px;
    color: var(--accent);
    flex-shrink: 0;
  }

  @media(max-width: 900px) {
    .rep-body-split { grid-template-columns: 1fr; }
    .rep-chart-area { border-right: none; border-bottom: 1px solid var(--border); }
  }

  body.light .rep-legend-pill .rep-dot { box-shadow: 0 0 0 3px rgba(0,0,0,0.03); }
  body.light .rep-fallout-banner { background: #fff1f0; color: #b42318; border-color: rgba(248,81,73,0.4); }
  body.light .rep-tip-card { background: #f6f8fd; border-color: #d8e1f0; color: #1f2937; }
  body.light .rep-legend-pill { background: #f6f8fd; border-color: #d8e1f0; }
  body.light .pace-block { box-shadow: 0 10px 24px rgba(17,24,39,0.06); }
  body.light .pace-icon-box { background: #f7faff; }

      .date-input-wrap:not(:last-child) {
    margin-right: 10px;
}

  /* Stats Dashboard fixes */
  .stats-full { margin-top: 50px; display: flex; flex-direction: column; gap: 20px; }
  .stats-two-columns { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; align-items: start; }
  .stats-main { display: flex; flex-direction: column; gap: 16px; }
  .side-stack { display: flex; flex-direction: column; gap: 16px; }
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
  .card-head { font-size: 18px; font-weight: 700; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; }
  .finance-title { font-size: 20px; font-weight: 800; color: #fff; }
  body.light .finance-title { color: #0f172a; }
  .finance-sub { color: var(--muted); font-size: 13px; margin-top: 4px; }
  .goal-wrap { margin-bottom: 18px; }
  .goal-info { display: flex; justify-content: space-between; font-size: 13px; color: var(--muted); margin-bottom: 8px; font-weight: 600; }
  .card-head-actions { display: flex; align-items: center; gap: 10px; }
  .top-clients-card { margin-top: 0; overflow: hidden; position: relative; }
  .top-clients-card::before { content: ""; position: absolute; inset: 0; background: radial-gradient(circle at 12% 20%, rgba(88,166,255,0.05), transparent 32%), radial-gradient(circle at 92% 8%, rgba(163,113,247,0.08), transparent 28%); pointer-events: none; }
  .top-clients-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 14px; }
  .top-clients-title { font-size: 18px; font-weight: 800; letter-spacing: -0.3px; color: var(--text); }
  .top-clients-sub { color: var(--muted); font-weight: 600; font-size: 14px; }
  .top-clients-legend { display: inline-flex; align-items: center; gap: 8px; color: var(--muted); font-size: 13px; font-weight: 700; background: var(--pill-bg); border: 1px solid var(--border); padding: 8px 10px; border-radius: 10px; }
  .top-clients-controls { display: flex; align-items: center; gap: 8px; }
  .top-clients-mode-btn { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--button-bg); border: 1px solid var(--border); color: var(--text); border-radius: 10px; font-weight: 800; font-size: 13px; letter-spacing: -0.2px; cursor: pointer; transition: .2s; }
  .top-clients-mode-btn:hover { border-color: var(--accent); color: var(--accent); }
  .top-clients-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--purple); box-shadow: 0 0 0 4px rgba(163,113,247,0.12); }
  .top-clients-chart { height: 260px; margin-top: 12px; }
  .inline-link-btn { padding: 8px 12px; background: transparent; border: 1px solid var(--border); color: var(--muted); border-radius: 8px; font-weight: 700; font-size: 13px; cursor: pointer; transition: .2s; }
  .inline-link-btn:hover { color: var(--accent); border-color: var(--accent); background: var(--button-bg); }
  body.light .inline-link-btn { color: #2d3a55; border-color: #cbd8f1; background: #f7faff; box-shadow: 0 4px 14px rgba(17,24,39,0.05); }
  body.light .inline-link-btn:hover { color: #1f4cad; border-color: #3b82f6; background: #eaf2ff; }
  .progress-bg { height: 14px; background: var(--progress-bg); border-radius: 12px; overflow: hidden; border: 1px solid var(--progress-border); margin-top: 8px; width: 100%; box-shadow: var(--progress-shadow); }
  .progress-fill { height: 100%; width: 0; background: linear-gradient(90deg, var(--progress-fill-start), var(--progress-fill-end)); transition: width 0.5s; box-shadow: var(--progress-fill-shadow); border-radius: 12px; }
  .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
  .stat-box { padding: 14px; border: 1px solid var(--border); border-radius: 10px; background: var(--card-alt); }
  .stat-label-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 6px; }
  .stat-label { font-size: 12px; color: var(--muted); text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; }
  .stat-pill { padding: 2px 8px; border-radius: 999px; font-size: 11px; font-weight: 700; background: rgba(88,166,255,0.12); color: var(--accent); border: 1px solid rgba(88,166,255,0.3); }
  #goal-pill { background: var(--goal-pill-bg); border-color: var(--goal-pill-border); color: var(--goal-pill-color); padding: 6px 12px; font-size: 13px; box-shadow: var(--goal-pill-shadow); display: inline-flex; gap: 6px; align-items: center; }
  #goal-pill::before { content: "⚡"; }
  .stat-val { font-size: 30px; font-weight: 800; }
  .stat-helper { font-size: 12px; color: var(--muted); margin-top: 4px; }
  .text-green { color: var(--green); }
  .text-gold { color: var(--gold); }
  .mono { font-family: monospace; }
  .stat-scope-note { margin-top: 6px; color: var(--muted); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; }
  .status-pill { display: inline-flex; align-items: center; justify-content: center; width: 34px; height: 34px; border-radius: 12px; font-weight: 800; background: var(--status-bg); border: 1px solid var(--status-border); color: var(--status-text); box-shadow: inset 0 1px 0 rgba(255,255,255,0.05); }
  .status-pill svg { width: 16px; height: 16px; opacity: 0.95; }
  .status-pill.active { color: #3fb950; border-color: rgba(63,185,80,0.25); background: rgba(63,185,80,0.12); }
  .status-pill.waiting { color: #d29922; border-color: rgba(210,153,34,0.25); background: rgba(210,153,34,0.12); }
  .status-pill.potential { color: #58a6ff; border-color: rgba(88,166,255,0.28); background: rgba(88,166,255,0.12); }
  .status-pill.paused { color: #a371f7; border-color: rgba(163,113,247,0.28); background: rgba(163,113,247,0.12); }
  .status-pill.archive { color: #8b949e; border-color: rgba(139,148,158,0.25); background: rgba(139,148,158,0.12); }
  body.light .status-pill { box-shadow: none; }
  body.light .status-pill.active { color: #18794e; border-color: rgba(26,126,69,0.28); background: rgba(24,121,78,0.12); }
  body.light .status-pill.waiting { color: #9a6b00; border-color: rgba(154,107,0,0.3); background: rgba(255,202,58,0.18); }
  body.light .status-pill.potential { color: #1f65c0; border-color: rgba(31,101,192,0.32); background: rgba(31,101,192,0.12); }
  body.light .status-pill.paused { color: #5a3ba6; border-color: rgba(90,59,166,0.34); background: rgba(90,59,166,0.14); }
  body.light .status-pill.archive { color: #5b6575; border-color: rgba(91,101,117,0.32); background: rgba(91,101,117,0.16); }
  .status-pill-icon { width: 16px; height: 16px; }

  .paid-summary { display: flex; flex-direction: column; gap: 4px; align-items: flex-end; }
  .paid-chip { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 9px; background: var(--pill-bg); border: 1px solid var(--border); color: var(--muted); font-size: 12px; font-weight: 800; }
  .paid-amount { font-weight: 800; color: var(--text); }
  body.light .paid-chip { background: #f1f5fd; }
  .trash-text { font-weight: 700; color: var(--text); }
  .record-texts { flex:1; min-width: 0; }
  .record-title { color: var(--muted); font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
  .record-motiv { color: #f0f6fc; font-weight: 700; margin-top: 4px; font-size: 15px; }
  .record-progress-bg { margin-top: 10px; height: 10px; background: var(--record-bg); border-radius: 10px; overflow: hidden; border: 1px solid var(--record-border); width: 100%; box-shadow: var(--record-shadow); }
  .record-progress-fill { height: 100%; width: 0; background: linear-gradient(90deg, var(--record-fill-start), var(--record-fill-end)); box-shadow: var(--record-fill-shadow); transition: width .4s ease; border-radius: 999px; }
  .record-value { font-size: 24px; font-weight: 900; color: var(--gold); text-align: right; }
  .record-remaining { color: var(--muted); font-weight: 700; font-size: 12px; text-align: right; margin-top: 4px; }
  .record-side { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
  .reputation-card { max-width: 100%; width: 100%; overflow: hidden; }
  .rep-chart-area canvas { width: 100% !important; height: 240px !important; }
  .rep-chip { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-weight: 700; font-size: 12px; }
  .rep-chip.good { background: rgba(46,160,67,0.15); color: #2ea043; }
  .rep-chip.warn { background: rgba(210,153,34,0.15); color: #d29922; }
  .rep-chip.bad { background: rgba(248,81,73,0.15); color: #f85149; }
  .reputation-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
  .rep-metric { padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: var(--card-alt); }
  .rep-label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.6px; font-weight: 800; }
  .rep-value { font-size: 18px; font-weight: 800; color: #f0f6fc; margin-top: 6px; }
  .rep-helper { font-size: 12px; color: var(--muted); margin-top: 4px; line-height: 1.4; }
  body.light .rep-metric { background: #f6f8fd; border-color: #d8e1f0; }
  body.light .rep-value { color: #1f2937; }
  body.light .rep-helper { color: #4b5563; }
  .reputation-mini { display: grid; grid-template-columns: 1fr 1.1fr; gap: 12px; align-items: stretch; }
  .rep-chart-box { border: 1px solid var(--border); border-radius: 10px; padding: 12px; background: var(--card-alt); min-height: 140px; display: flex; flex-direction: column; gap: 8px; position: relative; overflow: visible; }
  .rep-chart-box::after { content: ""; position: absolute; inset: 0; pointer-events: none; background: radial-gradient(circle at 30% 20%, rgba(88,166,255,0.12), transparent 45%); opacity: 0.5; }
  .rep-chart-legend { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; gap: 8px; }
  .rep-chart-legend .legend-title { display: flex; align-items: center; gap: 6px; }
  .rep-chart-legend .legend-score { display: inline-flex; align-items: center; gap: 6px; font-weight: 800; color: var(--text); background: rgba(46,160,67,0.1); padding: 4px 10px; border-radius: 999px; }
  .rep-chart-caption { display: flex; gap: 6px; flex-wrap: wrap; font-size: 12px; color: var(--muted); margin-top: 6px; }
  .rep-chart-pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 8px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255,255,255,0.02); }
  .rep-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
  .rep-dot.good { background: #2ea043; box-shadow: 0 0 0 3px rgba(46,160,67,0.15); }
  .rep-dot.warn { background: #d29922; box-shadow: 0 0 0 3px rgba(210,153,34,0.15); }
  .rep-dot.bad { background: #f85149; box-shadow: 0 0 0 3px rgba(248,81,73,0.18); }
  .rep-tips { border: 1px solid var(--border); border-radius: 10px; padding: 12px; background: var(--card-alt); display: flex; flex-direction: column; gap: 8px; }
  .rep-tips-title { font-weight: 800; color: #f0f6fc; font-size: 13px; letter-spacing: 0.3px; text-transform: uppercase; }
  .rep-tip { display: flex; gap: 8px; color: var(--muted); font-size: 13px; line-height: 1.4; }
  .rep-tip svg { width: 16px; height: 16px; color: #58a6ff; flex-shrink: 0; }
  body.light .rep-chart-box { background: #f6f8fd; border-color: #d8e1f0; }
  body.light .rep-chart-box::after { background: radial-gradient(circle at 30% 20%, rgba(59,130,246,0.12), transparent 45%); }
  body.light .rep-chart-pill { background: #f7faff; border-color: #d8e1f0; color: #374151; }
  body.light .rep-tips { background: #f6f8fd; border-color: #d8e1f0; }
  body.light .rep-tips-title { color: #1f2d45; }
  .reputation-top-row { display: flex; justify-content: space-between; gap: 12px; flex-wrap: wrap; align-items: center; }
  .rep-score-chip { display: flex; align-items: center; gap: 10px; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--card-alt); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); }
  .rep-score-icon { width: 32px; height: 32px; border-radius: 10px; display: grid; place-items: center; background: var(--pill-bg); color: var(--accent); border: 1px solid var(--border); font-weight: 900; }
  .rep-score-meta { display: flex; flex-direction: column; line-height: 1.2; }
  .rep-score-label { color: var(--muted); font-size: 12px; font-weight: 800; letter-spacing: 0.4px; text-transform: uppercase; }
  .rep-score-main { font-size: 18px; font-weight: 900; }
  .rep-actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  .rep-severity { padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); font-weight: 800; text-transform: uppercase; letter-spacing: 0.4px; }
  .rep-severity.good { background: rgba(46,160,67,0.1); color: #2ea043; border-color: rgba(46,160,67,0.35); }
  .rep-severity.warn { background: rgba(210,153,34,0.1); color: #d29922; border-color: rgba(210,153,34,0.4); }
  .rep-severity.bad { background: rgba(248,81,73,0.1); color: #f85149; border-color: rgba(248,81,73,0.4); }
  .rep-cta { padding: 9px 14px; border-radius: 10px; border: 1px solid var(--border); background: var(--card); color: var(--text); font-weight: 800; display: inline-flex; align-items: center; gap: 6px; }
  .rep-cta:hover { border-color: var(--accent); color: var(--accent); }
  .rep-cta svg { width: 16px; height: 16px; }
  .link-preview { margin-top: 10px; padding: 10px 12px; border: 1px dashed var(--border); border-radius: 12px; background: var(--card-alt); display: flex; justify-content: space-between; align-items: center; gap: 10px; }
  .link-preview-body { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 0; }
  .link-preview-head { display: flex; align-items: center; gap: 10px; min-width: 0; flex-wrap: wrap; }
  .link-preview-label { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; background: var(--pill-bg); border: 1px solid var(--border); color: var(--muted); font-size: 12px; font-weight: 800; letter-spacing: -0.2px; white-space: nowrap; }
  .link-preview-info { display: inline-flex; align-items: center; gap: 8px; min-width: 0; flex: 1; }
  .link-preview-url { font-weight: 800; color: var(--accent); text-decoration: underline; transition: color .2s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; word-break: normal; flex: 1; min-width: 0; }
  .link-preview-url:hover { color: #8ab4ff; }
  .link-preview-title { color: var(--muted); font-size: 13px; line-height: 1.4; word-break: break-word; white-space: normal; overflow: hidden; text-overflow: ellipsis; }
  .link-preview-actions { display: flex; gap: 8px; align-items: center; }
  .link-preview button { padding: 8px 12px; min-height: 36px; }
  .edit-link-btn { display: inline-flex; align-items: center; gap: 6px; background: var(--button-bg); border-color: var(--border); color: var(--text); font-weight: 700; }
  .edit-link-btn svg { width: 14px; height: 14px; }
  /* Bulk Toolbar */
  .bulk-toolbar {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); 
      background: var(--card); padding: 10px 20px; border-radius: 12px; 
      border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex; gap: 15px; z-index: 999; align-items: center;
  }
  .bulk-action-btn {
      background: var(--button-bg); border: 1px solid var(--border); color: var(--text);
      padding: 8px 15px; font-size: 14px; border-radius: 6px; cursor: pointer;
      transition: .2s; white-space: nowrap;
  }
  .bulk-action-btn.delete { color: var(--red); border-color: var(--red); }
  .bulk-action-btn:hover { background: var(--btn-hover); border-color: var(--accent); color: var(--accent); }
  .bulk-action-btn.delete:hover { background: var(--del-hover-bg); color: var(--red); border-color: var(--del-hover-border); }
  
  /* Bulk Move Select */
  .bulk-move-select {
      padding: 8px 15px;
      background: var(--button-bg);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      outline: none;
      transition: .2s;
  }
  .bulk-move-select:hover { border-color: var(--accent); }
  .bulk-move-select option { background: var(--card); }

  .settings-pane[data-pane="blocks"] .settings-section { background: var(--card); border: 1px solid var(--border); box-shadow: none; }
  .settings-pane[data-pane="blocks"] .block-setting { background: transparent; border: none; box-shadow: none; padding: 14px 0; border-bottom: 1px solid var(--border); border-radius: 0; }
  .settings-pane[data-pane="blocks"] .block-setting:last-child { border-bottom: none; }
  .settings-pane[data-pane="blocks"] .settings-row { background: transparent; border: none; padding: 0; }
  .settings-pane[data-pane="blocks"] .block-preview { background: transparent; border: none; padding: 8px 0 0; box-shadow: none; }
  .settings-pane[data-pane="blocks"] .preview-card { background: var(--card-alt); }


  /* Modals */
  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:var(--modal-overlay);z-index:1000;justify-content:center;align-items:center;backdrop-filter: blur(4px); overflow-y: auto; padding: 40px 16px;}
  .modal-content{background:var(--card);padding:30px;border-radius:16px;width:460px;max-width:95%;border:1px solid var(--border);text-align:center; position: relative; box-shadow: 0 18px 60px rgba(0,0,0,0.35);}
  .modal-content.modal-wide {
    width: 920px;
    max-width: 96vw;
    text-align: left;
    overflow: hidden;
    max-height: calc(100vh - 80px);
    overflow-y: auto;
  }
  
  /* Inputs & Selects inside modal */
  .inp-group{margin-bottom:15px;text-align:left;}
  .inp-group label{display:block;margin-bottom:5px;font-size:13px;color:var(--muted);font-weight:600;}
  .inp-group input, .inp-group select {background-color: var(--input-bg);border:1px solid var(--border);padding:9px 10px;width:100%;color:var(--text);border-radius:8px; outline: none; box-sizing: border-box;}
  .row-inputs{display:flex;gap:14px;margin-bottom:15px;flex-wrap:wrap; align-items:flex-start;}
  .row-inputs > div {flex: 1 1 180px;}
  .contractor-row { align-items: flex-end; column-gap: 14px; }
  .contractor-row .contractor-group { min-width: 260px; display: flex; flex-direction: column; gap: 10px; }
  .contractor-row .tax-group { min-width: 140px; }
  .requests-row { align-items: flex-end; }
  .requests-row .inp-group { margin-bottom: 0; }
  .input-with-clear { position: relative; flex: 1 1 260px; display: flex; align-items: center; }
  .input-with-clear input { padding-right: 40px; width: 100%; }
  .clear-input-btn { position: absolute; right: 8px; display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 7px; border: 1px solid transparent; background: var(--button-bg); color: var(--muted); cursor: pointer; transition: .12s; box-shadow: inset 0 1px 0 rgba(255,255,255,0.03); }
  .clear-input-btn:hover { color: var(--text); border-color: transparent; background: var(--input-bg); }
  .clear-input-btn.hidden { opacity: 0; pointer-events: none; }
  .input-error { border-color: var(--red) !important; box-shadow: 0 0 0 2px rgba(218,54,51,0.12); }
  .deadline-presets { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .deadline-presets select,
  .deadline-presets input { background: var(--input-bg); border: 1px solid var(--border); padding: 10px 12px; border-radius: 10px; color: var(--text); min-height: 44px; font-weight: 800; transition: .15s; }
  .deadline-presets select:focus,
  .deadline-presets input:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 2px rgba(88,166,255,0.14); }
  .add-modal-actions { position: sticky; bottom: 0; background: linear-gradient(180deg, transparent 0%, var(--card) 32%); padding-bottom: 10px; }
  .deadline-presets select { min-width: 130px; max-width: 160px; white-space: nowrap; flex: 0 0 150px; }
  .deadline-presets input { min-width: 100px; max-width: 140px; flex: 0 1 120px; }
  .deadline-time { min-width: 110px; max-width: 140px; flex: 0 0 120px; padding: 10px 12px; }
  .modal-deadline-presets { flex-wrap: wrap; justify-content: flex-start; margin: 12px 0 6px; }
  .modal-deadline-presets { gap: 6px; }
  .modal-deadline-presets select { min-width: 148px; }
  .modal-deadline-presets input { flex: 0 0 90px; max-width: 98px; min-width: 88px; }
  .modal-deadline-presets .deadline-clear-btn { height: 44px; padding: 0 14px; white-space: nowrap; }
  .date-modal-footer { display: flex; justify-content: flex-end; align-items: center; margin: 10px 0 6px; gap: 10px; flex-wrap: wrap; }
  .date-duo { display: flex; gap: 12px; align-items: stretch; margin-bottom: 12px; flex-wrap: wrap; }
  .date-duo .inp-group { margin-bottom: 0; }
  .date-duo-card { flex: 1 1 220px; min-width: 0; padding: 0; border-radius: 14px; border: none; background: transparent; box-shadow: none; }
  .date-duo .inp-group label { display: flex; align-items: center; gap: 6px; color: var(--muted); font-weight: 700; }
  .date-chip { margin-top: 8px; }
  .deadline-display { display: inline-flex; align-items: center; gap: 8px; line-height: 1.2; }
  .deadline-display .date-text { display: inline-flex; align-items: center; gap: 6px; flex-wrap: nowrap; }
  .deadline-delta { color: var(--muted); font-size: 12px; font-weight: 750; letter-spacing: -0.1px; }
  .deadline-delta.overdue { color: var(--red); }

  .timeline-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 12px; margin-bottom: 10px; align-items: start; }
  .timeline-pair { display: grid; grid-template-columns: repeat(2, minmax(200px, 1fr)); column-gap: 12px; row-gap: 0; align-items: stretch; }
  .timeline-row .inp-group { margin-bottom: 0; display: flex; flex-direction: column; gap: 6px; align-items: flex-start; }
  .timeline-row .deadline-presets { justify-content: flex-start; flex-wrap: nowrap; }
  .timeline-row .date-input-wrap { width: 100%; }

  .currency-symbol { pointer-events: none; }
  
  .close-modal-x { 
      position: absolute; 
      top: 10px; 
      right: 15px; 
      font-size: 24px; 
      color: var(--muted); 
      cursor: pointer; 
      line-height: 1;
      opacity: 0.7;
      transition: opacity 0.2s;
  }
  .close-modal-x:hover { opacity: 1; }
  .save-stg { padding: 12px 16px; border-radius: 12px; font-weight: 800; letter-spacing: 0.1px; background: var(--btn-blue); border: 1px solid var(--btn-blue); color: #fff; transition: transform .1s, box-shadow .1s, background .1s; cursor: pointer; justify-content: center; text-align: center; line-height: 1.35; }
  .save-stg:hover { transform: translateY(-1px); box-shadow: none; color: #fff; background: #2f81f7; }
  .modal .save-stg { width: 100%; margin-top: 20px; }
  .request-add-btn { width: auto; align-self: flex-end; min-width: 140px; height: 46px; margin-top: 0; }
  .request-add-btn:hover { box-shadow: none; transform: none; }

  /* --- Modern Completion Modal (Updated) --- */
  .complete-modal-card { 
      max-width: 500px; 
      width: 100%;
      text-align: left; 
      padding: 32px; 
      border-radius: 24px; /* Более сильное скругление */
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      background: var(--card);
  }
  .complete-modal { display: flex; flex-direction: column; gap: 24px; }
  
  .complete-head { display: flex; flex-direction: column; gap: 8px; }
  .complete-title { font-size: 26px; font-weight: 900; letter-spacing: -0.5px; line-height: 1.1; }
  .complete-sub { color: var(--muted); font-weight: 500; font-size: 15px; line-height: 1.5; }

  /* Блок "Откуда -> Куда" */
  .complete-status-flow { 
      background: var(--bg); /* Контрастный фон */
      border: 1px solid var(--border); 
      border-radius: 16px; 
      padding: 16px 20px; 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
  }
  .status-flow-label { font-weight: 700; color: var(--muted); font-size: 13px; }
  .status-flow { display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 14px;}
  .status-pill-static {
      padding: 6px 12px; border-radius: 8px; background: var(--card); border: 1px solid var(--border);
  }
  .status-pill-done {
      padding: 6px 12px; border-radius: 8px;
      background: rgba(46,160,67,0.15); border: 1px solid transparent; color: var(--green);
  }
  .status-flow-arrow { color: var(--muted); opacity: 0.5; }

  /* Блок с датой */
  .complete-date-card { 
      background: var(--card-alt); 
      border: 1px solid var(--border); 
      border-radius: 18px; 
      padding: 20px; 
      display: flex; 
      flex-direction: column; 
      gap: 16px; 
  }
  .complete-date-head-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; }
  .complete-date-title { font-weight: 800; font-size: 16px; color: var(--text); }
  .complete-date-sub { font-size: 13px; color: var(--muted); margin-top: 4px; font-weight: 500; max-width: 240px; line-height: 1.4; }
  .complete-chip { 
      font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
      padding: 6px 10px; border-radius: 8px; background: var(--bg); border: 1px solid var(--border); color: var(--muted);
  }

  .complete-inputs-col { display: flex; flex-direction: column; gap: 12px; }
  .complete-input-group { position: relative; }
  .complete-input-group label { 
      display: block; font-size: 13px; font-weight: 700; margin-bottom: 6px; color: var(--text); 
  }
  .complete-input-wrap { 
      display: flex; align-items: center; gap: 12px; 
      background: var(--input-bg); 
      border: 1px solid var(--border); 
      border-radius: 12px; 
      padding: 12px 14px; 
      transition: .2s;
  }
  .complete-input-wrap:focus-within {
      border-color: var(--accent); 
      box-shadow: 0 0 0 3px rgba(88,166,255,0.15);
      background: var(--bg);
  }
  .complete-input { 
      width: 100%; background: transparent; border: none; outline: none; 
      font-weight: 700; font-size: 16px; color: var(--text); font-family: inherit;
  }
  .complete-icon { color: var(--muted); width: 20px; height: 20px; }

  /* Блок успеха/предупреждения */
  .complete-feedback {
      display: flex; gap: 14px; padding: 16px; border-radius: 16px;
      align-items: flex-start; transition: .3s;
  }
  .complete-feedback.success { background: rgba(46,160,67,0.12); border: 1px solid rgba(46,160,67,0.2); }
  .complete-feedback.warning { background: rgba(210,153,34,0.12); border: 1px solid rgba(210,153,34,0.2); }
  .complete-feedback.info { background: var(--card-alt); border: 1px solid var(--border); }
  
  .feedback-check {
      width: 24px; height: 24px; border-radius: 6px; display: grid; place-items: center;
      flex-shrink: 0; font-size: 14px;
  }
  .feedback-check svg { width: 14px; height: 14px; }
  .success .feedback-check { background: #2ea043; color: white; box-shadow: 0 4px 10px rgba(46,160,67,0.3); }
  .warning .feedback-check { background: #d29922; color: white; box-shadow: 0 4px 10px rgba(210,153,34,0.3); }

  .feedback-content h4 { font-size: 15px; font-weight: 800; margin: 0 0 4px 0; color: var(--text); }
  .feedback-content p { font-size: 13px; margin: 0; color: var(--muted); line-height: 1.4; font-weight: 600;}
  .success h4 { color: #2ea043; } body.dark .success h4 { color: #3fb950; }
  .warning h4 { color: #d29922; }

  /* Кнопки */
  .complete-actions { display: grid; grid-template-columns: 1fr 1.5fr; gap: 12px; margin-top: 10px; }
  .btn-big {
      height: 52px; border-radius: 12px; font-weight: 800; font-size: 15px; cursor: pointer; transition: .2s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-cancel { background: transparent; border: 2px solid var(--border); color: var(--text); }
  .btn-cancel:hover { border-color: var(--muted); }
  .btn-submit { background: var(--btn-blue); border: none; color: #fff; box-shadow: 0 8px 20px rgba(47,129,247,0.25); }
  .btn-submit:hover,
  .btn-submit:focus { color: #fff; border: none; transform: translateY(-2px); box-shadow: 0 12px 24px rgba(47,129,247,0.35); filter: brightness(1.1); }
  
  /* Settings Modal specific padding fix */
  #settingsModal .modal-content {
      padding: 32px; /* Увеличен отступ для заголовка */
      width: 960px;
      max-width: min(1040px, 100%);
      max-height: calc(100vh - 80px);
      display: flex;
      flex-direction: column;
      text-align: left;
  }
  #settingsModal .modal-content h2 { margin-bottom: 15px; }

  /* --- Обновленные Настройки (Settings Modal) --- */
  .settings-modal { 
      padding: 0 !important; 
      overflow: hidden; 
      display: flex; 
      flex-direction: column; 
      background: var(--card);
  }
  .settings-header {
      padding: 24px 32px;
      border-bottom: 1px solid var(--border);
      background: var(--card);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: space-between;
  }
  .settings-title { font-size: 26px; font-weight: 900; letter-spacing: -0.25px; }
  .settings-sub { font-weight: 600; color: var(--muted); opacity: 0.8; font-size: 13px; }
  .settings-layout {
      display: flex;
      flex: 1;
      overflow: hidden;
      margin: 0;
      background: var(--bg); /* Контрастный фон для контента */
      min-height: 0;
  }
  .settings-tabs {
      width: 240px;
      flex-shrink: 0;
      padding: 16px 18px;
      background: var(--card);
      border: none;
      border-right: 1px solid var(--border);
      border-radius: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: none;
      position: static;
  }
  .settings-nav-btn {
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 650;
      background: transparent;
      border: 1px solid transparent;
      color: var(--muted);
      text-align: left;
      cursor: pointer;
      transition: background .2s, color .2s, border-color .2s, transform .2s;
      display: flex;
      align-items: center;
      gap: 10px;
  }
  .settings-nav-btn:hover { background: var(--button-bg); color: var(--text); border-color: var(--border); transform: translateX(2px); }
  .settings-nav-btn.active {
      background: var(--card-alt);
      color: var(--text);
      border-color: var(--border);
      box-shadow: none;
      font-weight: 750;
  }
  .settings-nav-icon { width: 16px; height: 16px; opacity: 0.8; }
  .settings-content {
      flex: 1;
      padding: 32px;
      overflow-y: auto;
      min-height: 0;
  }
  .settings-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.02);
      margin-bottom: 24px;
      padding: 24px;
  }
  .settings-actions-row {
      padding: 20px 32px;
      background: var(--card);
      border-top: 1px solid var(--border);
      margin: 0;
  }
  .settings-grid { display: grid; gap: 14px; }
  .settings-pane { display: none; flex-direction: column; gap: 14px; }
  .settings-pane.active { display: flex; }
  .settings-columns { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; }
  .settings-section-title { font-weight: 800; font-size: 16px; display:flex; align-items:flex-start; justify-content: space-between; gap: 10px; text-align: left; }
  .settings-section-sub { color: var(--muted); font-size: 13px; margin-top: 4px; font-weight: 500; opacity: 0.85; }
  .settings-options { display: grid; gap: 12px; margin-top: 12px; }
  .settings-row { display:flex; justify-content: space-between; align-items: flex-start; gap: 14px; padding: 12px 14px; border:1px solid var(--border); border-radius: 12px; background: var(--card-alt); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); transition: border-color .2s, background .2s; text-align: left; }
  .settings-row-title { font-weight: 800; }
  .settings-row-sub { color: var(--muted); font-size: 13px; font-weight: 500; margin-top: 4px; max-width: 520px; opacity: 0.9; }
  .settings-pill { margin-left: auto; padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,0.02); border: 1px solid var(--border); font-weight: 700; color: var(--muted); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); font-size: 12px; }
  .toggle-switch { position: relative; display: inline-block; width: 46px; height: 26px; }
  .toggle-switch input { opacity: 0; width: 0; height: 0; }
  .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border); transition: .2s; border-radius: 999px; }
  .toggle-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color:var(--muted); transition: .2s; border-radius: 50%; }
  .toggle-switch input:checked + .toggle-slider { background-color: var(--btn-blue); }
  .toggle-switch input:checked + .toggle-slider:before { transform: translateX(18px); background: #fff; }
  .radio-card { display:flex; gap: 14px; border:1px solid var(--border); padding: 14px 16px; border-radius: 14px; align-items: center; background: var(--card-alt); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); transition: border-color .2s, box-shadow .2s, transform .15s; }
  .radio-card input { margin-top: 0; transform: translateY(1px); }
  .radio-card:hover { border-color: var(--accent); box-shadow: 0 12px 26px rgba(0,0,0,0.18); transform: translateY(-1px); }
  .radio-card-title { font-weight: 900; letter-spacing: -0.2px; }
  .radio-card-sub { color: var(--muted); font-size: 13px; font-weight: 600; line-height: 1.45; }
  .radio-grid { display:grid; gap:10px; margin-top: 10px; }
  .block-setting { display: grid; gap: 12px; border: 1px solid var(--border); border-radius: 14px; padding: 12px; background: var(--card); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); position: relative; }
  .block-setting.is-off .settings-row { border-color: rgba(255,255,255,0.08); }
  .block-setting.is-off .block-preview { filter: grayscale(1); opacity: 0.5; }
  .block-setting.is-off .preview-state { opacity: 1; transform: translateY(0); }
  .block-preview { border: 1px solid var(--border); border-radius: 12px; padding: 14px; background: linear-gradient(135deg, rgba(88,166,255,0.08), rgba(163,113,247,0.08)); display: grid; gap: 10px; position: relative; overflow: hidden; }
  .block-preview--neutral { background: linear-gradient(135deg, rgba(17,23,34,0.9), rgba(16,20,28,0.96)); }
  body.light .block-preview { background: linear-gradient(135deg, rgba(59,130,246,0.06), rgba(124,82,228,0.06)); }
  body.light .block-preview--neutral { background: linear-gradient(135deg, #f9fbff, #f4f6fb); border-color: #d8e1f0; box-shadow: 0 10px 28px rgba(17,24,39,0.06); }
  .preview-banner { background: linear-gradient(90deg, rgba(248,81,73,0.2), rgba(88,166,255,0.15)); border: 1px solid rgba(248,81,73,0.35); padding: 10px; border-radius: 10px; font-weight: 700; color: var(--text); display: flex; gap: 10px; align-items: center; justify-content: space-between; }
  .preview-pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 10px; background: var(--card); border:1px solid var(--border); font-size: 12px; font-weight: 800; color: var(--text); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); }
  .preview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
  .preview-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 10px; min-height: 70px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); position: relative; }
  .preview-card.small { min-height: 52px; }
  .preview-bar { height: 10px; border-radius: 999px; background: var(--border); overflow: hidden; box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
  .preview-bar span { display: block; height: 100%; background: linear-gradient(90deg, var(--btn-blue), var(--purple)); width: 70%; box-shadow: 0 6px 18px rgba(163,113,247,0.25); }
  .preview-state { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.55); color: #fff; border-radius: 10px; padding: 6px 10px; font-size: 11px; font-weight: 800; letter-spacing: 0.4px; text-transform: uppercase; opacity: 0; transform: translateY(-4px); transition: opacity .2s, transform .2s; }
  body.light .preview-state { background: rgba(255,255,255,0.9); color: #1f2937; border: 1px solid #e2e8f5; box-shadow: 0 6px 18px rgba(17,24,39,0.08); }
  .settings-actions { display:flex; gap: 12px; flex-wrap: wrap; margin-top: 12px; }
  .settings-actions button { flex: 1; justify-content: center; min-width: 180px; }
  .settings-footer-note { color: var(--muted); font-size: 12px; font-weight: 500; margin-top: 8px; line-height: 1.5; }
  .settings-chip-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 12px; }
  .settings-chip { display: flex; align-items: flex-start; justify-content: space-between; gap: 10px; padding: 10px 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--card-alt); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); font-weight: 700; text-align: left; }
  .settings-chip .settings-row-sub { margin-top: 0; }
  .settings-chip small { color: var(--muted); font-size: 12px; font-weight: 500; }
  .settings-chip strong { font-size: 13px; letter-spacing: -0.2px; }
  .settings-row .toggle-switch, .settings-chip .toggle-switch { margin-top: 2px; }


  .scroll-toggle { position: fixed; right: 18px; bottom: 18px; width: 48px; height: 48px; border-radius: 12px; border: 1px solid var(--border); background: var(--button-bg); color: var(--text); display: grid; place-items: center; font-size: 20px; font-weight: 900; cursor: pointer; box-shadow: 0 12px 28px rgba(0,0,0,0.18); z-index: 1200; opacity: 0.95; }
  .scroll-toggle:hover { background: var(--btn-hover); border-color: var(--accent); color: var(--accent); }
  .scroll-toggle svg { width: 18px; height: 18px; display: block; }

  /* Layout edit mode */
  .edit-controls, .edit-hint { display: none; }
  .layout-edit [data-editable] { position: relative; outline: 1px dashed var(--border); border-radius: 12px; overflow: hidden; }
  .layout-edit [data-editable].is-hidden { display: none !important; }
  .layout-edit .edit-controls { position: absolute; top: 10px; right: 10px; display: flex; gap: 6px; z-index: 5; }
  .layout-edit .edit-hint { display: inline-flex; }
  .layout-edit .edit-handle { width: 36px; height: 36px; border-radius: 12px; display: inline-flex; align-items: center; justify-content: center; background: var(--card-alt); border: 1px solid var(--border); color: var(--text); cursor: grab; box-shadow: 0 6px 18px rgba(0,0,0,0.22); }
  .layout-edit [draggable="true"] .edit-handle { cursor: grab; }
  .layout-edit .edit-remove { width: 36px; height: 36px; border-radius: 12px; display: inline-flex; align-items: center; justify-content: center; background: rgba(218,54,51,0.1); border: 1px solid rgba(218,54,51,0.35); color: var(--red); font-weight: 900; cursor: pointer; box-shadow: 0 6px 18px rgba(0,0,0,0.15); }
  .layout-edit .edit-remove:hover { background: rgba(218,54,51,0.15); border-color: rgba(218,54,51,0.55); }
  .layout-edit .edit-remove svg { width: 17px; height: 17px; }
  .layout-edit .drag-over { outline-color: var(--accent); box-shadow: 0 0 0 2px rgba(88,166,255,0.35); }
  .layout-edit .edit-hint { position: absolute; bottom: 10px; right: 10px; background: var(--pill-bg); color: var(--muted); padding: 6px 10px; border-radius: 8px; font-size: 12px; font-weight: 700; border: 1px solid var(--border); }
  .layout-edit .dragging { opacity: 0.55; transform: scale(0.99); box-shadow: 0 10px 28px rgba(0,0,0,0.28); }
  .layout-edit .block-drop-target { outline: 2px dashed var(--accent); border-radius: 12px; }
  .drag-ghost { position: absolute; top: -9999px; left: -9999px; padding: 6px; border-radius: 14px; background: var(--card); box-shadow: 0 16px 38px rgba(0,0,0,0.35); opacity: 0.95; border: 1px solid var(--border); overflow: hidden; pointer-events: none; }
  body.light .drag-ghost { background: #fff; box-shadow: 0 16px 38px rgba(17,24,39,0.1); border-color: #d8e1f0; }

  .footer-note { color: var(--muted); font-size: 12px; font-weight: 600; }
  .helper-note { color: var(--muted); font-size: 12px; margin-top: 6px; line-height: 1.4; text-align: left; }
  .settings-actions-row { display: flex; justify-content: flex-end; gap: 10px; align-items: center; margin-top: 8px; flex-wrap: wrap; }
  .btn-ghost { background: transparent; border-color: var(--border); color: var(--muted); font-weight: 800; }
  .btn-ghost:hover { color: var(--accent); border-color: var(--accent); }

  /* Date/Time Input Styling (Override attempts for dark theme) */
  .inp-group input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); opacity: 0.8; cursor: pointer; }
  .inp-group input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); opacity: 0.8; cursor: pointer; }
  .inp-group input:focus, .inp-group select:focus { border-color: var(--accent); }

  .date-time-inputs input {
      background: var(--card-alt);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 12px;
      border-radius: 10px;
      font-weight: 700;
      letter-spacing: 0.2px;
      width: 100%;
      transition: border-color .2s, background .2s, box-shadow .2s;
  }

  .date-time-inputs { display: flex; gap: 15px; width: 100%; }
  .input-with-icon { position: relative; flex: 1; }
  .input-with-icon .input-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--muted); opacity: 0.9; }
  .input-with-icon input { padding-left: 38px; }
  .input-with-icon .flatpickr-input { width: 100%; }

  .flatpickr-alt-input {
      background: var(--card-alt);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 12px;
      border-radius: 10px;
      font-weight: 700;
      letter-spacing: 0.2px;
      width: 100%;
      padding-left: 38px;
  }

  .flatpickr-alt-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(88,166,255,0.15);
      background: var(--date-focus-bg);
  }

  .date-time-inputs input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(88,166,255,0.15);
      background: var(--date-focus-bg);
  }

  .date-time-inputs input:disabled {
      opacity: 0.4;
      cursor: not-allowed;
  }

  /* Flatpickr Dark Theme Tweaks */
  .flatpickr-calendar {
      background: var(--card-alt);
      border: 1px solid var(--border);
      box-shadow: 0 16px 40px rgba(0,0,0,0.45);
      color: var(--text);
      border-radius: 14px;
      overflow: hidden;
  }

  .flatpickr-months,
  .flatpickr-weekdays,
  .flatpickr-time {
      background: var(--card-alt);
      border-color: var(--border);
  }

  .flatpickr-months .flatpickr-month {
      color: var(--text);
  }

  .flatpickr-monthDropdown-months,
  .flatpickr-current-month input.cur-year {
      color: var(--text);
      background: var(--card-alt);
      border-radius: 8px;
      border: 1px solid var(--border);
  }

  .flatpickr-monthDropdown-months option {
      background: var(--card-alt);
      color: var(--text);
  }

  .flatpickr-day, .flatpickr-weekday {
      color: var(--text);
      border-radius: 10px;
  }

  .flatpickr-day:hover, .flatpickr-day:focus {
      background: rgba(88,166,255,0.12);
      border-color: rgba(88,166,255,0.35);
  }

  .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange, .flatpickr-day.selected.inRange {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 4px 16px rgba(88,166,255,0.35);
  }

  .flatpickr-day.today:not(.selected) {
      border-color: var(--accent);
      color: var(--accent);
  }

  .flatpickr-weekday {
      color: #d0d7e0;
      font-weight: 700;
      letter-spacing: 0.4px;
      text-transform: uppercase;
  }

  .flatpickr-months .flatpickr-prev-month svg,
  .flatpickr-months .flatpickr-next-month svg {
      fill: var(--text);
  }

  .flatpickr-time {
      border-top: 1px solid var(--border);
      padding: 10px 12px;
      display: flex;
      justify-content: center;
      gap: 10px;
  }

  .flatpickr-time input, .flatpickr-time .numInputWrapper span {
      color: #e9edf4;
  }

  .flatpickr-time .flatpickr-time-separator { color: var(--muted); font-weight: 800; }

  .flatpickr-time .numInputWrapper {
      border: 1px solid #3a3f4b;
      border-radius: 12px;
      background: linear-gradient(180deg, #161b22, #0d1118);
      overflow: hidden;
      min-width: 76px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 8px 20px rgba(0,0,0,0.3);
      transition: border-color .2s, box-shadow .2s, background .2s;
  }

  .flatpickr-time .numInputWrapper:focus-within {
      border-color: rgba(88,166,255,0.7);
      box-shadow: 0 0 0 1px rgba(88,166,255,0.25), 0 10px 30px rgba(0,0,0,0.35);
      background: linear-gradient(180deg, #111722, #0b1016);
  }

  .flatpickr-time input {
      background: transparent;
      font-weight: 800;
      font-size: 16px;
      text-align: center;
      padding: 10px 12px;
      letter-spacing: 0.3px;
  }

  .flatpickr-time input:hover, .flatpickr-time .numInputWrapper span:hover {
      background: rgba(88,166,255,0.08);
  }

  .flatpickr-time .numInputWrapper span {
      background: transparent;
      transition: background .15s;
  }

  .flatpickr-time .numInputWrapper span.arrowUp:after,
  .flatpickr-time .numInputWrapper span.arrowDown:after {
      border-bottom-color: var(--accent);
      border-top-color: var(--accent);
  }
  body.light .flatpickr-calendar { box-shadow: 0 18px 40px rgba(17,24,39,0.16); }
  body.light .flatpickr-months,
  body.light .flatpickr-weekdays,
  body.light .flatpickr-time { background: #fff; }
  body.light .flatpickr-time input, body.light .flatpickr-time .numInputWrapper span { color: #111827; }
  body.light .flatpickr-time .numInputWrapper { background: #f8fbff; border-color: #d8e1f0; box-shadow: inset 0 1px 0 rgba(255,255,255,0.9); }
  body.light .flatpickr-time .numInputWrapper:focus-within { background: #eef3ff; border-color: #3b82f6; box-shadow: 0 0 0 1px rgba(59,130,246,0.15), 0 10px 30px rgba(17,24,39,0.12); }
  body.light .flatpickr-time input:hover, body.light .flatpickr-time .numInputWrapper span:hover { background: rgba(59,130,246,0.08); }

  /* Finance Block Percentage */
  .stat-val-small { font-size: 16px; font-weight: 600; color: var(--muted); margin-left: 10px;}
  .stat-label-row { display: flex; align-items: center; justify-content: space-between; }
  .stat-val-margin { font-size: 24px; font-weight: 800; color: var(--text); }
  .stat-label-with-help { display: inline-flex; align-items: center; gap: 6px; color: var(--muted); }
  .help-icon { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; border-radius: 50%; border: 1px solid var(--help-border); background: var(--help-bg); color: var(--help-text); font-size: 11px; cursor: help; position: relative; transition: border-color .2s, color .2s, background .2s, box-shadow .2s; box-shadow: inset 0 1px 0 rgba(255,255,255,0.15); }
  .help-icon:hover { color: var(--accent); border-color: var(--accent); background: var(--help-hover-bg); box-shadow: 0 4px 14px rgba(0,0,0,0.08); }
  .help-icon::after { content: attr(data-tooltip); position: absolute; left: 50%; bottom: calc(100% + 8px); transform: translateX(-50%); background: var(--card-alt); color: var(--text); padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); box-shadow: 0 8px 30px rgba(0,0,0,0.2); width: 260px; max-width: 70vw; font-size: 12px; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity .15s, visibility .15s; z-index: 10; text-transform: none; }
  .help-icon:hover::after { opacity: 1; visibility: visible; }
  .text-red { color: var(--red); }
  .symbol-select { width: 68px !important; padding: 8px; text-align: center; }
  
  /* Link Modal Specific */
  #linkModal .modal-content { width: 350px; }
  
  /* Checkbox styling */
  .checkbox-wrap { 
    display: flex; align-items: center; gap: 8px; font-size: 14px; 
    color: var(--muted); margin-bottom: 15px; cursor: pointer;
    user-select: none;
  }
  .checkbox-wrap input[type="checkbox"] { width: 16px; height: 16px; margin: 0; cursor: pointer; }
  
  /* Trash Table Button Fix */
  .trash-action-btns { display: flex; gap: 10px; align-items: center; }
  #t-trash tbody td { vertical-align: middle; }
  #t-trash tbody td:nth-child(5) { text-align: right; }
  #t-trash tbody td:nth-child(6) { text-align: right; }
  .trash-action-btns { justify-content: flex-end; }
  .restore-trash-btn, .delete-forever-text {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s, border-color 0.2s;
      white-space: nowrap;
      text-decoration: none; /* For delete-forever-text */
      display: inline-block;
      text-align: center;
      min-width: 100px;
  }
  .restore-trash-btn { 
      color: var(--green); 
      border: 1px solid var(--green); 
      background: transparent; 
  }
  .restore-trash-btn:hover { 
      background: rgba(46, 160, 67, 0.1);
  }
  .delete-forever-text {
      color: var(--red);
      border: 1px solid var(--red);
      background: transparent;
      opacity: 1; /* Полная видимость */
  }
  .delete-forever-text:hover {
       background: rgba(218, 54, 51, 0.1);
  }

  .trash-expire { color: var(--muted); font-size: 12px; font-weight: 700; }
  .trash-toolbar { display: flex; justify-content: space-between; align-items: center; gap: 12px; padding: 14px 0 6px; }
  .trash-clean-btn { padding: 12px 16px; border-radius: 10px; background: var(--button-bg); border: 1px solid var(--border); color: var(--text); font-weight: 800; display: inline-flex; align-items: center; gap: 8px; }
  .trash-clean-btn:hover { border-color: var(--accent); color: var(--accent); }
  .trash-date-cell { display: flex; flex-direction: column; gap: 4px; min-height: 48px; justify-content: center; }
  #t-trash .trash-date-cell { min-height: 68px; }
  .trash-deleted-label { font-weight: 800; color: var(--text); font-size: 13px; }
  #view-trash .table-wrap { padding: 5px 14px 5px 18px; }
  #t-trash { border-collapse: collapse; border-spacing: 0; min-width: 1200px; width: 100%; }
  #t-trash thead th { background: transparent; border-bottom: 1px solid var(--border); padding: 12px 10px; border-radius: 0; }
  #t-trash tbody tr { background: transparent; border: none; box-shadow: none; position: relative; }
  #t-trash tbody td { border-bottom: 1px solid var(--table-border); padding: 12px 10px; }
  #t-trash tbody tr:hover td { background: var(--row-hover); }
  .trash-label { color: var(--muted); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; margin-bottom: 4px; }
  .trash-client { font-weight: 800; color: var(--text); display: flex; align-items: center; min-height: 22px; }
  .trash-project { font-weight: 800; color: var(--accent); display: flex; align-items: center; min-height: 22px; }
  .trash-amount { font-size: 17px; font-weight: 900; color: var(--text); }
  .trash-row-meta { display: flex; flex-direction: column; gap: 6px; min-height: 56px; justify-content: center; }
  .trash-row { transition: background .2s, box-shadow .2s; }
  .trash-row:hover td { background: var(--row-hover); }
  .trash-row .row-controls { position: absolute; z-index: 2; }
  .trash-row-meta, .trash-action-btns, .trash-date-cell { position: relative; z-index: 1; }
  .trash-expire.neutral { color: var(--muted); }
  .trash-expire.warn { color: var(--gold); }
  .trash-expire.danger { color: var(--red); }

  .template-card { display: flex; flex-direction: column; height: 100%; align-self: start; }
  .template-manager { display: flex; flex-direction: column; gap: 10px; width: 100%; margin-top: 0; margin-bottom: 4px; padding-bottom: 2px; position: relative; flex: 1; }
  .template-manager-title { color: var(--muted); font-size: 13px; font-weight: 700; letter-spacing: -0.1px; padding-top: 0; margin-bottom: 4px; }
  .template-wide { grid-column: 1 / -1; }
  .template-wide .template-manager { margin-top: 0; padding-top: 10px; }
  .template-create-inline { display: inline-flex; align-items: center; gap: 6px; background: transparent; border: none; color: var(--accent); font-weight: 800; padding: 6px 0 0; cursor: pointer; font-size: 14px; }
  .template-create-inline:hover { color: #8ab4ff; }
  .template-actions-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-top: 8px; }
  .template-secondary-btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; background: var(--button-bg); border: 1px solid var(--border); color: var(--text); border-radius: 10px; font-weight: 800; font-size: 14px; cursor: pointer; }
  .template-secondary-btn:hover { border-color: var(--accent); color: var(--accent); }
  .template-manager-modal { max-height: 80vh; overflow: hidden; }
  .modal.modal-centered { align-items: center; }
  .template-list { display: flex; flex-direction: column; gap: 10px; margin-top: 14px; max-height: 60vh; overflow: auto; padding-right: 6px; }
  .template-empty { color: var(--muted); font-weight: 700; font-size: 14px; padding: 12px; border: 1px dashed var(--border); border-radius: 12px; background: var(--pill-bg); }
  .deadline-clear-btn { padding: 9px 12px; border-radius: 10px; border: 1px dashed var(--border); background: transparent; color: var(--muted); font-weight: 700; display: inline-flex; align-items: center; gap: 6px; }
  .deadline-clear-btn svg { width: 14px; height: 14px; }
  .deadline-clear-btn:hover { border-color: var(--accent); color: var(--accent); }
  .template-row { display: grid; grid-template-columns: auto auto 1fr auto; align-items: center; gap: 10px; padding: 10px 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--pill-bg); cursor: grab; transition: border-color .15s, box-shadow .15s, background .15s; }
  .template-row:active { cursor: grabbing; }
  .template-row.drag-over { box-shadow: 0 0 0 2px var(--accent); }
  .template-row.selected { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent); background: linear-gradient(120deg, rgba(88,166,255,0.08), rgba(163,113,247,0.04)); }
  .template-drag-handle { width: 18px; height: 18px; display: inline-flex; align-items: center; justify-content: center; color: var(--muted); }
  .template-row input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); font-weight: 800; }
  .template-row input:focus { border-color: var(--accent); outline: none; }
  .template-row .template-delete-btn { border: none; background: transparent; color: var(--muted); padding: 4px 6px; cursor: pointer; font-weight: 800; font-size: 18px; }
  .template-row .template-delete-btn:hover { color: var(--red); }
  .template-select-btn { width: 32px; height: 32px; border-radius: 9px; border: 1px solid var(--border); background: var(--button-bg); color: var(--muted); display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: .15s; font-weight: 900; }
  .template-select-btn:hover { color: var(--text); border-color: var(--accent); }
  .template-select-btn.is-active { background: var(--accent); border-color: var(--accent); color: #fff; box-shadow: 0 10px 24px rgba(88,166,255,0.28); }
  .template-inline-block { border-top: 1px solid var(--border); padding-top: 12px; margin-top: 6px; }
  .template-pills { display: flex; gap: 8px; overflow-y: auto; overflow-x: hidden; padding: 6px 4px 10px 2px; scrollbar-width: none; margin-top: 0; max-width: 100%; position: relative; flex: 1; flex-wrap: wrap; align-content: flex-start; }
  .template-pills::-webkit-scrollbar { display: none; }
  .template-pills::after, .template-pills::before { display: none; }
  .template-helper { font-size: 12px; font-weight: 700; color: var(--muted); margin-top: 8px; }
  .template-helper.error { color: var(--red); }
  .template-helper.success { color: var(--green); }
  .template-pill { display: inline-flex; align-items: center; gap: 8px; padding: 7px 10px; border-radius: 10px; background: var(--pill-bg); border: 1px solid var(--border); font-weight: 700; color: var(--text); white-space: nowrap; cursor: grab; user-select: none; }
  .template-pill:active { cursor: grabbing; }
  .template-pill.drag-over { box-shadow: 0 0 0 2px var(--accent); }
  .template-pill .template-fill-btn { border: none; background: transparent; color: var(--text); padding: 0; cursor: pointer; font-weight: 800; }
  .template-pill .template-fill-btn:hover { color: var(--accent); }
  .template-pill .template-delete-btn { border: none; background: transparent; color: var(--muted); padding: 0 4px; cursor: pointer; font-weight: 800; }
  .template-pill .template-delete-btn:hover { color: var(--red); }
  .template-add-btn { align-self: flex-start; margin-top: 0; height: 52px; min-height: 52px; display: inline-flex; align-items: center; justify-content: center; padding: 0 16px; }
  .template-modal-add { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: end; margin: 12px 0 4px; }
  .template-modal-input { margin-bottom: 0; }
  .template-modal-input label { margin-bottom: 6px; }
  .contractor-layout { display: flex; flex-direction: column; gap: 10px; align-items: stretch; }
  .contractor-group { align-self: stretch; min-width: 0; }
  .tax-group { flex: 0 0 130px; }
  .contractor-mode-select { width: 100%; padding: 12px 14px; border-radius: 12px; font-weight: 600; min-height: 46px; min-width: 0; color: var(--text); border: 1px solid var(--border); background: var(--input-bg); box-shadow: none; }
  .contractor-amount { display: flex; flex-direction: column; gap: 8px; background: var(--pill-bg); border: 1px solid transparent; padding: 14px; border-radius: 12px; width: 100%; box-shadow: inset 0 1px 0 rgba(255,255,255,0.03); }
  .contractor-amount-row { margin-top: 2px; }
  .input-with-suffix { display: grid; grid-template-columns: 1fr auto; align-items: stretch; gap: 0; width: 100%; }
  .input-with-suffix input { border-radius: 10px 0 0 10px; min-width: 0; padding: 11px 14px; border: 1px solid var(--border); background: var(--card); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); height: 44px; }
  .input-with-suffix input:focus { z-index: 1; border-color: var(--accent); }
  .input-suffix { display: inline-flex; align-items: center; justify-content: center; padding: 0 14px; background: var(--card-alt); border: 1px solid var(--border); border-left: none; border-radius: 0 10px 10px 0; font-weight: 800; color: var(--muted); min-width: 52px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); height: 44px; }
  .contractor-helper { color: var(--muted); font-size: 12px; font-weight: 700; line-height: 1.4; }
  .contractor-input { width: 100%; }
  .tax-group { align-self: flex-end; }
  .is-hidden { display: none !important; }
  .expense-cell input:disabled { background: var(--input-bg); color: var(--muted); cursor: not-allowed; }
  .deadline-links-row { margin-top: 12px; display: flex; align-items: center; justify-content: flex-start; }
  .deadline-row { display: flex; align-items: center; gap: 10px; }
  .deadline-row .date-input-wrap { flex: 1; }
  .deadline-row .deadline-clear-btn { margin: 0; height: 44px; padding: 0 12px; }
  .link-inline-btn { width: auto; min-height: 44px; padding: 10px 14px; }
  .template-add-btn { min-height: 52px; height: 52px; display: inline-flex; align-items: center; justify-content: center; padding: 0 18px; }
  .link-inline-btn { padding: 10px 14px; font-weight: 800; gap: 10px; box-shadow: 0 6px 16px rgba(59,130,246,0.08); }
  .link-inline-btn span { color: var(--text); font-size: 13px; }


.date-cell:not(:last-child) .date-input-wrap {
    margin-right: 8px;
}


      .date-cell:first-of-type .date-input-wrap {
    margin-right: 8px;
}


td.date-cell + td.date-cell {
    padding-left: 10px !important;
}

/* --- New Project Modal (Updated) --- */
  .modal-layout-modern {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }
  
  .modal-section-title {
    font-size: 12px;
    text-transform: uppercase;
    color: var(--muted);
    font-weight: 800;
    letter-spacing: 0.8px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .modal-section-title::after {
    content: "";
    flex: 1;
    height: 1px;
    background: var(--border);
    opacity: 0.5;
  }
  
  .form-grid-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
  }

  .form-grid-row.finance {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
  
  /* Класс для элементов во всю ширину (Название проекта) */
  .form-grid-full {
    grid-column: 1 / -1;
    width: 100%;
  }

  /* Исправленный блок с инпутами */
  .inp-modern { display: flex; flex-direction: column; gap: 6px; }
  .inp-modern label { font-size: 13px; font-weight: 700; color: var(--text); }
  .inp-modern input, .inp-modern select {
    background: var(--input-bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 14px;
    color: var(--text);
    height: 44px;
    width: 100%;
  }
  .inp-modern input:focus, .inp-modern select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(88,166,255,0.1);
  }

  .template-control-group { display: flex; align-items: center; gap: 8px; margin-top: 6px; }
  .tpl-btn-chip {
    font-size: 12px; font-weight: 700; padding: 4px 10px; border-radius: 8px; cursor: pointer;
    border: 1px solid transparent; display: flex; align-items: center; gap: 6px;
  }
  .tpl-btn-chip.create { background: rgba(88,166,255,0.1); color: var(--accent); }
  .tpl-btn-chip.list { background: var(--card-alt); border-color: var(--border); color: var(--muted); }
  .tpl-btn-chip svg { width: 14px; height: 14px; }

  /* Date Panel */
  .date-panel {
    background: var(--card-alt); border: 1px solid var(--border); border-radius: 12px; padding: 14px;
    display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: end;
  }
  .date-presets-row {
    grid-column: 1 / -1; display: flex; gap: 8px; border-top: 1px solid var(--border);
    padding-top: 12px; margin-top: 4px; align-items: center; flex-wrap: wrap;
  }

  /* --- Стили для строки дат в модалке (в одну линию) --- */
  .date-panel-row {
      display: flex;
      align-items: flex-end; /* Выравнивание по нижнему краю инпутов */
      gap: 12px;
      width: 100%;
  }
  .date-panel-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
  }
  .date-panel-item.shrink {
      flex: 0 0 auto;
      width: 160px; /* Ширина для дропдауна */
  }
  .date-panel-item.mini {
      flex: 0 0 80px; /* Ширина для поля дней */
  }
  /* Скрываем стандартные лейблы внутри этого ряда, если нужно сэкономить место, или оставляем */
  .date-panel-row label {
      font-size: 13px;
      font-weight: 800;
      white-space: nowrap;
  }

  /* --- Обновленный Блок Эффективность --- */
  .eff-card-modern {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.02);
  }
  .eff-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
  }
  .eff-title {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 800;
      letter-spacing: -0.2px;
  }
  .eff-content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
  }
  .eff-chart-box {
      background: transparent;
      border: none;
      padding: 0;
      min-height: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
  }
  .eff-label {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 12px;
      text-align: center;
      width: 100%;
  }

  /* --- Обновленный Блок Рекорд (Premium Look) --- */
  .record-clean {
      position: relative;
      background: radial-gradient(circle at top right, rgba(250, 204, 21, 0.05), transparent 40%), var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.03);
  }
  .rec-clean-header {
      margin-bottom: 20px;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 12px;
  }
  .rec-clean-title {
      font-size: 15px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
  }
  .rec-edit-link {
      background: transparent;
      border: 1px solid transparent;
      color: var(--accent);
      font-weight: 800;
      font-size: 13px;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: color .2s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
      justify-self: end;
  }
  .rec-edit-link:hover {
      color: #8ab4ff;
      background: var(--tab-hover);
      border-color: var(--border);
      text-decoration: underline;
  }
  .rec-edit-link:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(88,166,255,0.35);
      border-color: var(--accent);
  }
  .rec-clean-icon { display: none; } /* Убираем иконку, делаем минималистично */

  .rec-clean-values {
      display: grid;
      grid-template-columns: minmax(0,1fr) minmax(220px, 280px);
      gap: 18px;
      align-items: start;
      margin-bottom: 18px;
  }
  .rec-current-val {
      font-size: 40px;
      letter-spacing: -1px;
      background: linear-gradient(90deg, var(--text), var(--muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 900;
      line-height: 1.1;
  }
  .rec-target-val {
      font-size: 32px;
      color: var(--gold);
      font-weight: 800;
      line-height: 1.1;
  }

  .rec-val-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
  }

  .rec-goal-group {
      max-width: 280px;
      justify-self: end;
  }

  .rec-label {
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.4px;
      text-transform: uppercase;
      font-weight: 800;
  }

  .rec-progress-track {
      background: var(--button-bg);
      border: none;
      height: 12px;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 18px;
      margin-bottom: 14px;
  }
  .rec-progress-bar {
      background: linear-gradient(90deg, #facc15, #f59e0b);
      box-shadow: 0 0 10px rgba(250, 204, 21, 0.4);
      height: 100%;
      border-radius: 999px;
  }

  .rec-status-text {
      margin-top: 6px;
      font-weight: 700;
      color: var(--muted);
      text-align: left;
  }

  /* --- Reputation Metrics Update --- */
  .rep-metric-compact {
      display: flex; flex-direction: column; gap: 4px;
  }
  .rep-metric-row { display: flex; justify-content: space-between; align-items: baseline; }
  .rep-metric-big { font-size: 20px; font-weight: 800; color: var(--text); }
  .rep-metric-label { font-size: 11px; text-transform: uppercase; color: var(--muted); font-weight: 700; }
  .rep-split-val { display: flex; gap: 12px; margin-top: 4px; }
  .rep-sub-item { display: flex; flex-direction: column; }
  .rep-sub-val { font-size: 14px; font-weight: 700; color: var(--text); }
  .rep-sub-lbl { font-size: 10px; color: var(--muted); }

  /* --- Стили для раздела "Все проекты" (Табличный вид) --- */
  .all-projects-table {
    display: grid;
    grid-template-columns: 40px 1fr 120px 100px; /* Статус | Имя | Дата | Сумма */
    gap: 10px;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
  }

  .all-projects-header {
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    font-size: 11px;
    letter-spacing: 0.5px;
    padding-bottom: 5px;
    border-bottom: 2px solid var(--card-alt);
    margin-bottom: 10px;
  }

  .apt-status { display: flex; justify-content: center; }
  .apt-name { display: flex; flex-direction: column; overflow: hidden; }
  .apt-name strong { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text); }
  .apt-name span { font-size: 11px; color: var(--muted); }
  .apt-date { color: var(--muted); font-size: 12px; text-align: right; }
  .apt-price { font-weight: 600; color: var(--accent); text-align: right; font-family: monospace; font-size: 13px; }

  /* --- Новые стили для дат в Архиве --- */
  .archive-date-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--muted);
    background: var(--bg);
    padding: 4px 8px;
    border-radius: 4px;
    margin-top: 8px;
    width: fit-content;
  }

  .archive-status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
    cursor: help;
    position: relative;
  }

  /* Цвета статусов */
  .status-ok { background-color: #2ea043; box-shadow: 0 0 5px rgba(46, 160, 67, 0.4); }
  .status-late { background-color: #f85149; box-shadow: 0 0 5px rgba(248, 81, 73, 0.4); }

  /* Простая подсказка при наведении */
  .archive-status-dot:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #000;
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    white-space: nowrap;
    font-size: 11px;
    pointer-events: none;
    margin-bottom: 6px;
    z-index: 10;
    border: 1px solid var(--border);
  }
