<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DesignFlow ‚Äî –¢—Ä–µ–∫–µ—Ä —Ü–µ–ª–µ–π</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Crect width='24' height='24' rx='6' ry='6' fill='%230d1117'/%3E%3Cpath d='M11 2 L5 14 H10 L9 22 L19 8 H13 L14 2 Z' fill='%23facc15'/%3E%3C/svg%3E">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
  
  <style>
    :root {
      --accent: #7c5cff;
      --accent-hover: #6a4bff;
      --text: #1e293b;
      --text-muted: #64748b;
      --bg: #f8fafc; /* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω (—Å–≤–µ—Ç–ª—ã–π) */
      --card-bg: #ffffff;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0,0,0,0.05);
      --red: #ef4444;
      --orange: #f97316;
      --green: #22c55e;
      
      /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –¥–ª—è WARNING (–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª–∏) */
      --warn-bg: var(--card-bg); 
      --warn-border: var(--border); 
      --warn-text: var(--text); 
      --warn-icon: var(--text-muted); 
    }

    body[data-theme="dark"] {
      --bg: #0f172a; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
      --card-bg: #1e293b; /* –§–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
      --text: #e2e8f0; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
      --text-muted: #94a3b8;
      --border: #334155;
      background: #020617; /* –ß—É—Ç—å –±–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è body */
      
      /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è WARNING (–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª–∏) */
      --warn-bg: var(--card-bg); 
      --warn-border: var(--border);
      --warn-text: var(--text); 
      --warn-icon: var(--text-muted); 
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background .3s, color .3s;
      overflow-y: scroll;
    }

    /* --- HEADER --- */
    .header-wrapper {
        margin-top: 24px;
        background: var(--bg);
        border-bottom: 1px solid var(--border);
        transition: background .3s, border-color .3s;
    }
    
    .header {
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      /* –¶–≤–µ—Ç –º–æ–ª–Ω–∏–∏ - –∂–µ–ª—Ç—ã–π/–∑–æ–ª–æ—Ç–æ–π */
      color: #fbbf24; 
      font-size: 20px;
      box-shadow: 0 4px 10px rgba(124, 92, 255, 0.2);
    }

    .logo-text h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 800;
      color: var(--accent);
      line-height: 1;
    }

    .logo-text h1 span {
      font-size: 13px;
      color: var(--text-muted);
      font-weight: 600;
      margin-left: 6px;
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 6px;
    }
    
    body[data-theme="dark"] .logo-text h1 span { background: #334155; }

    .logo-text p {
      margin: 4px 0 0;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* --- BUTTONS --- */
    .btn {
      padding: 9px 16px;
      border-radius: 10px;
      background: #f1f5f9;
      color: var(--text);
      font-size: 13px;
      cursor: pointer;
      font-weight: 600;
      border: 1px solid transparent;
      transition: .2s;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      white-space: nowrap;
    }
    
    /* –ò–∫–æ–Ω–∫–∏ –∫–Ω–æ–ø–æ–∫ –Ω–∞—Å–ª–µ–¥—É—é—Ç color: var(--text) */
    .btn i { color: inherit; } 

    body[data-theme="dark"] .btn { background: #334155; border-color: #475569; }
    .btn:hover { background: #e2e8f0; }
    body[data-theme="dark"] .btn:hover { background: #475569; }

    .btn.primary { background: var(--accent); color: white; border: none; }
    .btn.primary:hover { background: var(--accent-hover); }
    .btn.primary i { color: white; } /* –ë–µ–ª—ã–µ –∏–∫–æ–Ω–∫–∏ –Ω–∞ Primary –∫–Ω–æ–ø–∫–∞—Ö */

    .btn.secondary { background: transparent; border: 1px solid var(--border); }
    .btn.secondary:hover { background: #f8fafc; }
    body[data-theme="dark"] .btn.secondary:hover { background: #1e293b; }

    .btn.danger { background: #fee2e2; color: var(--red); }
    .btn.danger:hover { background: #fecaca; }

    /* --- WARNING BLOCK (–ù–ï–ô–¢–†–ê–õ–¨–ù–´–ô –°–¢–ò–õ–¨ + –¢–û–ß–ï–ß–ù–û–ï –ö–†–ê–°–ù–û–ï –í–´–î–ï–õ–ï–ù–ò–ï) --- */
    .warning-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
    }
    .warning {
      background: var(--warn-bg);
      border: 1px solid var(--warn-border);
      padding: 16px 24px;
      margin-top: 24px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.5;
      display: flex;
      justify-content: space-between; 
      align-items: center;
      gap: 20px;
      color: var(--warn-text); 
    }
    
    .warning-content {
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }
    
    /* –î–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ü–≤–µ—Ç –∏–∫–æ–Ω–∫–∏ (—Å–µ—Ä—ã–π/–∑–∞–≥–ª—É—à–µ–Ω–Ω—ã–π) */
    .warning i { color: var(--warn-icon); font-size: 16px; margin-top: 2px; } 
    .warning strong { font-weight: 700; color: var(--warn-text); } 
    
    .warning-actions {
        display: flex;
        gap: 10px;
        flex-shrink: 0; 
    }

    /* –¢–û–ß–ï–ß–ù–û–ï –ö–†–ê–°–ù–û–ï –í–´–î–ï–õ–ï–ù–ò–ï */
    .warning-red-icon,
    .warning-red-text {
        color: var(--red) !important;
    }
    .warning-red-text {
        font-weight: 700;
    }
    /* –ö–û–ù–ï–¶ –¢–û–ß–ï–ß–ù–û–ì–û –ö–†–ê–°–ù–û–ì–û –í–´–î–ï–õ–ï–ù–ò–Ø */


    /* --- TABS --- */
    .tabs-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
    }
    .tabs {
      display: flex;
      gap: 6px;
      padding: 20px 0 0;
      flex-wrap: wrap;
    }

    .tab {
      padding: 8px 14px;
      border-radius: 8px;
      background: transparent;
      color: var(--text-muted);
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: .2s;
    }

    .tab:hover { background: rgba(0,0,0,0.03); }
    body[data-theme="dark"] .tab:hover { background: rgba(255,255,255,0.05); }

    .tab.active { background: #e0e7ff; color: var(--accent); }
    body[data-theme="dark"] .tab.active { background: rgba(124, 92, 255, 0.2); }

    .tab .count { margin-left: 6px; opacity: 0.7; font-size: 0.9em; }

    /* --- LAYOUT --- */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 24px 60px; }

    .grid {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 24px;
      margin-top: 20px;
      align-items: start;
    }

    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .card h2 { font-size: 18px; font-weight: 700; margin: 0 0 20px; display: flex; align-items: center; gap: 8px;}
    .card h2 i { color: var(--accent); }

    /* --- FORM --- */
    .form-row {
      display: flex;
      gap: 12px;
      margin-bottom: 14px;
    }

    .form-row > * {
        flex: 1;
    }

    .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 14px; }
    
    label { 
      font-size: 12px; 
      color: var(--text-muted); 
      font-weight: 700; 
      text-transform: uppercase; 
      letter-spacing: 0.5px; 
      display: flex;
      align-items: center;
      position: relative; 
    }

    /* --- END TOOLTIP STYLE --- (–£–î–ê–õ–ï–ù–û) */


    input, textarea, select {
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--bg);
      font-size: 14px;
      color: var(--text);
      outline: none;
      width: 100%;
      box-sizing: border-box;
      transition: border-color .2s;
    }

    input:focus, textarea:focus, select:focus { border-color: var(--accent); background: var(--card-bg); }

    input::placeholder, textarea::placeholder {
        color: var(--text-muted);
        opacity: 0.8; 
    }

    body[data-theme="dark"] input, 
    body[data-theme="dark"] textarea, 
    body[data-theme="dark"] select {
      background: #0f172a;
    }
    body[data-theme="dark"] input:focus { background: #1e293b; }
    
    body[data-theme="dark"] input::placeholder,
    body[data-theme="dark"] textarea::placeholder {
        color: var(--text-muted);
        opacity: 1;
    }


    textarea { min-height: 80px; resize: vertical; font-family: inherit; }

    .custom-days-field { display: none; margin-top: 10px; }

    .btn-group { display: flex; gap: 10px; margin-top: 16px; }
    .btn-group .btn { flex: 1; justify-content: center; padding: 12px; }

    /* --- GOAL ITEMS --- */
    .goal-list { display: flex; flex-direction: column; gap: 16px; }

    .goal-card {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      background: var(--card-bg);
      transition: transform .2s, box-shadow .2s;
      position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞ */
      padding-left: 55px; /* –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –º–µ—Å—Ç–æ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ */
      cursor: pointer;
    }
    
    .goal-card:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.06); }
    
    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±–æ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ */
    .goal-card.selected {
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(124, 92, 255, 0.2), var(--shadow);
    }
    
    .goal-card-content {
        /* –í—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–∑–º–µ—Ç–∫–∞ —Ü–µ–ª–∏ */
        position: relative; 
        z-index: 1;
    }
    
    .goal-checkbox-wrapper {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 2; /* –ß–µ–∫–±–æ–∫—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–ª–∏–∫–∞–±–µ–ª–µ–Ω */
        height: 18px;
    }
    
    /* –°—Ç–∏–ª—å –¥–ª—è —Å–∞–º–æ–≥–æ —á–µ–∫–±–æ–∫—Å–∞, —á—Ç–æ–±—ã –æ–Ω –≤—ã–≥–ª—è–¥–µ–ª –∞–∫–∫—É—Ä–∞—Ç–Ω–æ */
    .goal-select-checkbox {
      margin: 0;
      width: 18px;
      height: 18px;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg);
      flex-shrink: 0;
      accent-color: var(--accent); /* –¶–≤–µ—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
    }
    
    body[data-theme="dark"] .goal-select-checkbox {
        background: #0f172a;
        border-color: #475569;
    }

    .goal-header { display: flex; justify-content: space-between; align-items: start; gap: 10px; }
    .goal-title { font-size: 18px; font-weight: 700; line-height: 1.3; color: var(--text); }

    .goal-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      margin: 10px 0;
      font-size: 13px;
      color: var(--text-muted);
    }
    
    /* –£–õ–£–ß–®–ï–ù–ò–ï: –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–º */
    .goal-meta > span { 
        color: var(--text); 
        font-weight: 600; 
    }
    .goal-meta > i { 
        color: var(--text-muted);
    }
    .goal-meta span .fa-clock { color: inherit; }


    .priority-badge {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px; 
    }
    
    /* –¶–≤–µ—Ç–∞ –∏ –∏–∫–æ–Ω–∫–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ */
    .priority-badge i { font-size: 12px; } 

    .priority-high { background: #fee2e2; color: var(--red); }
    .priority-med { background: #ffedd5; color: var(--orange); }
    .priority-low { background: #dcfce7; color: var(--green); }

    /* Dark theme priority badges */
    body[data-theme="dark"] .priority-high { background: #450a0a; color: #f87171; }
    body[data-theme="dark"] .priority-med { background: #451a03; color: #fb923c; }
    body[data-theme="dark"] .priority-low { background: #064e3b; color: #34d399; }

    .progress-bar {
      height: 8px;
      background: #e2e8f0;
      border-radius: 999px;
      overflow: hidden;
      margin: 16px 0 10px;
    }
    body[data-theme="dark"] .progress-bar { background: #334155; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), #c084fc); transition: width .5s; }

    .numbers { display: flex; justify-content: space-between; font-size: 15px; font-weight: 700; margin-bottom: 16px; }
    .numbers span:last-child { color: var(--text-muted); font-weight: 500; font-size: 14px; }

    /* Quick Actions */
    .quick-add { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .quick-btn {
      padding: 8px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      flex: 1;
      text-align: center;
      transition: .2s;
    }
    .quick-btn:hover { border-color: var(--accent); color: var(--accent); }

    body[data-theme="dark"] .quick-btn { background: #334155; border-color: #475569; }
    body[data-theme="dark"] .quick-btn:hover { background: #475569; border-color: var(--accent); }


    .actions-row { display: flex; gap: 10px; border-top: 1px solid var(--border); padding-top: 16px; }
    .action-icon-btn {
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-muted);
      background: transparent;
      border: none;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      transition: .2s;
    }
    .action-icon-btn:hover { background: #f1f5f9; color: var(--text); }
    .action-icon-btn.delete:hover { background: #fee2e2; color: var(--red); }
    
    body[data-theme="dark"] .action-icon-btn:hover { background: #334155; color: var(--text); }
    body[data-theme="dark"] .action-icon-btn.delete:hover { background: #450a0a; color: #f87171; }


    /* –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò KPI (–ù–æ–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞) */
    .kpi {
      display: flex; 
      justify-content: space-between; /* –ò—Å–ø–æ–ª—å–∑—É–µ–º space-between */
      gap: 15px; 
      margin-top: 16px;
      padding: 0;
      background: none; 
      text-align: center;
    }
    
    .kpi-item { 
      flex: 1; 
      padding: 0; 
      position: relative;
    }
    
    /* –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–Ω–∫–∏–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
    .kpi-item:not(:last-child)::after {
        content: '';
        position: absolute;
        right: -8px; 
        top: 5px;
        bottom: 5px;
        width: 1px;
        background: var(--border); 
    }
    
    .kpi-icon {
        color: var(--accent); 
        font-size: 16px;
        margin-bottom: 2px;
        display: block;
    }
    
    .kpi-value { 
        font-size: 20px; /* –ö—Ä—É–ø–Ω—ã–µ –∏ –∑–∞–º–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã */
        font-weight: 700; 
        color: var(--text); /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç */
        line-height: 1.1;
    }
    .kpi-label { 
        font-size: 11px; 
        color: var(--text-muted); 
        margin-top: 4px;
        font-weight: 600; 
        text-transform: uppercase; /* –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã */
        letter-spacing: 0.2px;
    }
    /* –ö–û–ù–ï–¶ –£–õ–£–ß–®–ï–ù–ù–´–• –°–¢–ò–õ–ï–ô KPI */
    
    /* --- MULTI-SELECT MODE STYLES --- */
    /* –ü–∞–Ω–µ–ª—å –º–∞—Å—Å–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π */
    .multi-action-bar {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 20px;
        margin-bottom: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 15px;
        box-shadow: var(--shadow);
    }
    .multi-action-text {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-muted);
    }
    .multi-action-btns {
        display: flex;
        gap: 10px;
        flex-shrink: 0;
    }
    
    /* --- TOAST & MODAL --- */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      z-index: 200;
      display: flex;
      align-items: center;
      gap: 12px;
      opacity: 0;
      transform: translateY(20px);
      transition: all .3s;
      font-size: 14px;
    }
    body[data-theme="dark"] .toast { background: #1e293b; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
    .toast.show { opacity: 1; transform: translateY(0); }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(2px);
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal.show { display: flex; }
    .modal-content {
      background: var(--card-bg);
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      animation: slideUp .3s ease;
    }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .modal-header h2 { margin: 0; font-size: 18px; font-weight: 700; }
    .modal-close { font-size: 20px; cursor: pointer; color: var(--text-muted); }

    .modal-body { padding: 24px; }
    .modal-actions { padding: 20px 24px; border-top: 1px solid var(--border); display: flex; gap: 10px; justify-content: flex-end; }
    
    .empty-message { text-align: center; padding: 50px; color: var(--text-muted); font-size: 15px; display: flex; flex-direction: column; align-items: center; gap: 12px; }

    /* --- CONFIRM MODAL SPECIFIC --- */
    #confirm-modal .modal-content { max-width: 400px; }
    #confirm-modal .modal-actions { justify-content: space-between; }
    #confirm-modal .modal-actions .btn { flex: 1; justify-content: center; padding: 12px; }
    #confirm-modal p { font-size: 16px; text-align: center; margin: 0; }

    /* --- FOOTER --- */
    .footer {
        padding: 40px 24px;
        text-align: center;
        border-top: 1px solid var(--border);
        margin-top: 20px;
        color: var(--text-muted);
        font-size: 13px;
    }
    .footer a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
    }
    .footer a:hover { text-decoration: underline; }
    
    /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–ª–æ–∫–∞ .warning */
    @media (max-width: 600px) {
        .warning {
            flex-direction: column;
            align-items: flex-start;
        }
        .warning-actions {
            margin-top: 10px;
            width: 100%;
            justify-content: stretch;
        }
        .warning-actions .btn {
            flex: 1;
        }
        
        .goal-card {
            padding-left: 20px; /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞, –≤ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±—É–¥–µ—Ç –Ω–µ–∫—Ä–∞—Å–∏–≤–æ */
        }
        .goal-checkbox-wrapper {
            top: 15px; /* –°–¥–≤–∏–≥–∞–µ–º —á–µ–∫–±–æ–∫—Å –≤ —É–≥–æ–ª */
            right: 15px;
            left: auto;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ */
        .desktop-only { display: none; }
        .multi-action-btns .btn {
            font-size: 0;
            padding: 8px 12px;
        }
        .multi-action-btns .btn i {
            font-size: 14px;
            margin: 0;
        }
    }
    
    @media (min-width: 601px) {
        .desktop-only { display: inline; }
    }
  </style>
</head>
<body>

  <div class="header-wrapper">
    <div class="header">
      <div class="logo-container">
        <div class="logo-icon"><i class="fa-solid fa-bolt"></i></div>
        <div class="logo-text">
          <h1>DesignFlow <span>v0.1</span></h1>
          <p>–¢—Ä–µ–∫–µ—Ä —Ü–µ–ª–µ–π</p>
        </div>
      </div>
      <div class="header-actions">
        <a href="https://zhegulyaev.github.io/DesignFlow/" class="btn secondary">
          <i class="fa-solid fa-list-check"></i> –¢—Ä–µ–∫–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤
        </a>
        
        <button class="btn" id="theme-btn"><i class="fa-solid fa-moon"></i></button>
      </div>
    </div>
  </div>

  <div class="warning-wrapper">
    <div class="warning"> 
        <div class="warning-content">
            <i class="fa-solid fa-triangle-exclamation warning-red-icon"></i>
            <div>
                <strong class="warning-red-text">–í–∞–∂–Ω–æ:</strong> –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.<br>
                –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–∫–∞—á–∏–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞ –∏–ª–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–∏—Å—Ç–µ–º—ã.
            </div>
        </div>
        <div class="warning-actions">
            <button class="btn" id="export-btn"><i class="fa-solid fa-download"></i> –°–∫–∞—á–∞—Ç—å –±–∞–∑—É</button>
            <button class="btn" id="import-btn"><i class="fa-solid fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
    </div>
  </div>

  <div class="tabs-wrapper">
    <div class="tabs">
      <div class="tab active" data-filter="active">–ê–∫—Ç–∏–≤–Ω—ã–µ <span class="count" id="active-count">0</span></div>
      <div class="tab" data-filter="done">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ <span class="count" id="done-count">0</span></div>
      <div class="tab" data-filter="all">–í—Å–µ —Ü–µ–ª–∏ <span class="count" id="total-count">0</span></div>
      <div class="tab" data-filter="trash">–ö–æ—Ä–∑–∏–Ω–∞ <span class="count" id="trash-count">0</span></div>
    </div>
  </div>

  <div class="container grid">
    <div class="card">
      <h2><i class="fa-solid fa-square-plus"></i> –°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å</h2>
      
      <div class="field">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input id="g-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–æ–≤—ã–π MacBook" />
      </div>

      <div class="form-row">
        <div class="field">
          <label>–°—É–º–º–∞</label>
          <input id="g-target" placeholder="100 000 –∏–ª–∏ 100–∫" inputmode="numeric" />
        </div>
        <div class="field">
          <label>–ï—Å—Ç—å</label>
          <input id="g-current" placeholder="0 –∏–ª–∏ 50–∫" inputmode="numeric" />
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label>–î–µ–¥–ª–∞–π–Ω</label>
          <input id="g-deadline" type="date" />
        </div>
        <div class="field">
          <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
          <select id="g-priority">
            <option value="med">–°—Ä–µ–¥–Ω–∏–π</option>
            <option value="high">–í—ã—Å–æ–∫–∏–π</option>
            <option value="low">–ù–∏–∑–∫–∏–π</option>
          </select>
        </div>
      </div>
      
      <div class="field">
        <label>–®–∞–±–ª–æ–Ω —Å—Ä–æ–∫–∞</label>
        <select id="g-template">
          <option value="">–í—ã–±—Ä–∞—Ç—å –±—ã—Å—Ç—Ä—ã–π —Å—Ä–æ–∫...</option>
          <option value="7">–ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é (7 –¥–Ω.)</option>
          <option value="14">–ß–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏ (14 –¥–Ω.)</option>
          <option value="30">–ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü (30 –¥–Ω.)</option>
          <option value="custom">–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç...</option>
        </select>
        <div class="custom-days-field" id="g-custom-days-field">
          <input id="g-custom-days-input" type="number" min="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª-–≤–æ –¥–Ω–µ–π" />
        </div>
      </div>

      <div class="field">
        <label>–ó–∞–º–µ—Ç–∫–∞</label>
        <textarea id="g-notes" placeholder="–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π, —Å—Å—ã–ª–∫–∏, –º—ã—Å–ª–∏..."></textarea>
      </div>

      <div class="btn-group">
        <button class="btn primary" id="btn-add"><i class="fa-solid fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="btn secondary" id="btn-demo"><i class="fa-solid fa-wand-magic-sparkles"></i> –î–µ–º–æ</button>
      </div>
    </div>

    <div>
       <div class="card" style="margin-bottom: 24px; padding: 20px;">
        <h2 style="font-size: 15px; margin-bottom:12px; color:var(--text-muted); font-weight:600;"><i class="fa-solid fa-chart-pie"></i> –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
        <div class="progress-bar" style="margin-top:0"><div class="progress-fill" id="overall-progress" style="width:0%"></div></div>
        <div style="font-size:13px; color:var(--text-muted); text-align:right; margin-top:8px;" id="overall-text">0%</div>
      </div>
      
      <div class="multi-action-bar" id="multi-action-bar" style="display: none;">
          <div class="multi-action-text" id="multi-action-text">–í—ã–±—Ä–∞–Ω–æ: 0</div>
          <div class="multi-action-btns">
              <button class="btn secondary" id="btn-select-all"><i class="fa-solid fa-list-check"></i> <span class="desktop-only">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</span></button>
              <button class="btn" id="btn-multi-done" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å"><i class="fa-solid fa-check"></i> <span class="desktop-only">–ì–æ—Ç–æ–≤–æ</span></button>
              <button class="btn danger" id="btn-multi-trash" title="–í –∫–æ—Ä–∑–∏–Ω—É"><i class="fa-regular fa-trash-can"></i> <span class="desktop-only">–í –∫–æ—Ä–∑–∏–Ω—É</span></button>
          </div>
      </div>
      
      <div class="goal-list" id="goals-list"></div>

    </div>
  </div>

  <div class="footer">
    DesignFlow Tracker by <a href="https://t.me/zhegulyaev" target="_blank">Zhegulyaev</a>
  </div>

  <div class="toast" id="toast">
    <i class="fa-solid fa-circle-check"></i> <span id="toast-message"></span>
  </div>

  <input type="file" id="file-import" accept="application/json" style="display:none" />

  <div class="modal" id="edit-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h2>
        <span class="modal-close"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="modal-body">
        <div class="field">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input id="edit-title" />
        </div>
        <div class="form-row">
          <div class="field">
            <label>–°—É–º–º–∞</label>
            <input id="edit-target" inputmode="numeric" placeholder="100 000 –∏–ª–∏ 100–∫" />
          </div>
          <div class="field">
            <label>–ï—Å—Ç—å —Å–µ–π—á–∞—Å</label>
            <input id="edit-current" inputmode="numeric" placeholder="0 –∏–ª–∏ 50–∫" />
          </div>
        </div>
        <div class="form-row">
          <div class="field">
            <label>–î–µ–¥–ª–∞–π–Ω</label>
            <input id="edit-deadline" type="date" />
          </div>
          <div class="field">
            <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
            <select id="edit-priority">
              <option value="med">–°—Ä–µ–¥–Ω–∏–π</option>
              <option value="high">–í—ã—Å–æ–∫–∏–π</option>
              <option value="low">–ù–∏–∑–∫–∏–π</option>
            </select>
          </div>
        </div>
        
        <div class="field">
            <label>–®–∞–±–ª–æ–Ω —Å—Ä–æ–∫–∞</label>
            <select id="edit-template">
                <option value="">–ù–µ –º–µ–Ω—è—Ç—å</option>
                <option value="7">7 –¥–Ω.</option>
                <option value="14">14 –¥–Ω.</option>
                <option value="30">–ú–µ—Å—è—Ü</option>
                <option value="custom">–°–≤–æ–π</option>
            </select>
            <div class="custom-days-field" id="edit-custom-days-field">
                <input id="edit-custom-days-input" type="number" min="1" placeholder="–î–Ω–µ–π" />
            </div>
        </div>
        
        <div class="field">
          <label>–ó–∞–º–µ—Ç–∫–∞</label>
          <textarea id="edit-notes"></textarea>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn primary" id="save-edit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modal" id="progress-modal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h2>–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h2>
        <span class="modal-close"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="modal-body">
        <div class="field">
          <label>–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
          <input id="progress-amount" placeholder="5 000 –∏–ª–∏ 5–∫" inputmode="numeric" autofocus />
        </div>
      </div>
      <div class="modal-actions" style="justify-content: space-between;">
        <button class="btn danger" id="btn-subtract"><i class="fa-solid fa-minus"></i> –í—ã—á–µ—Å—Ç—å</button>
        <button class="btn primary" id="btn-add-progress"><i class="fa-solid fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modal" id="confirm-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h2>
        <span class="modal-close"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="modal-body">
        <p id="confirm-text"></p>
      </div>
      <div class="modal-actions">
        <button class="btn secondary" id="confirm-cancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn danger" id="confirm-ok">–û–ö</button>
      </div>
    </div>
  </div>

<script>
(() => {
    // --- –£–ù–ò–ö–ê–õ–¨–ù–´–ï –ö–õ–Æ–ß–ò LOCAL STORAGE (–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–ù–§–õ–ò–ö–¢–ê) ---
    const K = 'designFlowGoalTrackerData';     // –ù–û–í–´–ô –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß
    const HISTORY_K = 'designFlowGoalHistoryData'; // –ù–û–í–´–ô –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß
    const DRAFT_K = 'designFlowGoalDraftData';   // –ù–û–í–´–ô –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß
    const BATCH_K = 'designFlowGoalBatchData';   // –ù–û–í–´–ô –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß
    const THEME_K = 'designFlowGoalThemeFinal'; // –ù–û–í–´–ô –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß –î–õ–Ø –¢–ï–ú–´
    // --- –ö–û–ù–ï–¶ –£–ù–ò–ö–ê–õ–¨–ù–´–• –ö–õ–Æ–ß–ï–ô ---
    
    let DATA = { goals: [] };
    let currentEditId = null;
    let currentProgressId = null;
    
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    let confirmAction = null;

    // NEW: Multi-selection state and elements
    let selectedGoalIds = new Set();
    const multiActionBar = document.getElementById('multi-action-bar');
    const multiActionText = document.getElementById('multi-action-text');
    const btnSelectAll = document.getElementById('btn-select-all');
    const btnMultiDone = document.getElementById('btn-multi-done');
    const btnMultiTrash = document.getElementById('btn-multi-trash');

    // New buttons for trash mode (created once to use in updateMultiActionBar)
    const btnMultiRestore = document.createElement('button');
    btnMultiRestore.className = 'btn';
    btnMultiRestore.innerHTML = '<i class="fa-solid fa-rotate-left"></i> <span class="desktop-only">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</span>';
    btnMultiRestore.title = '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
    btnMultiRestore.id = 'btn-multi-restore';

    const btnMultiFinalDelete = document.createElement('button');
    btnMultiFinalDelete.className = 'btn danger';
    btnMultiFinalDelete.innerHTML = '<i class="fa-solid fa-ban"></i> <span class="desktop-only">–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞</span>';
    btnMultiFinalDelete.title = '–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞';
    btnMultiFinalDelete.id = 'btn-multi-final-delete';


    function showToast(msg) {
        toastMessage.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function nowISO() {
        return new Date().toISOString();
    }

    // –•–µ–ª–ø–µ—Ä –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–∏—Å–µ–ª (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç "100–∫" –∏ "100 000")
    function safeParseNum(v) {
        if (!v) return 0;
        let str = String(v).replace(/\s+/g, '').replace(/,/g, '.').toLowerCase();
        let multiplier = 1;
        
        if (str.endsWith('–∫') || str.endsWith('k')) {
            multiplier = 1000;
            str = str.slice(0, -1);
        }
        
        const num = parseFloat(str);
        return isNaN(num) ? 0 : Math.round(num * multiplier);
    }
    
    // –•–µ–ª–ø–µ—Ä –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–ª–∞ (100000 -> 100 000)
    function formatNumber(num) {
        if (typeof num !== 'number') return '0';
        return num.toLocaleString('ru-RU');
    }

    // --- LOCAL STORAGE FUNCTIONS ---

    function save() {
        localStorage.setItem(K, JSON.stringify(DATA));
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫
        if (DATA.goals.length === 0) {
            localStorage.removeItem(DRAFT_K);
            localStorage.removeItem(BATCH_K);
        }
    }

    function load() {
        const json = localStorage.getItem(K);
        if (json) {
            try {
                DATA = JSON.parse(json);
                if (!DATA.goals) DATA.goals = [];
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", e);
                DATA = { goals: [] };
            }
        } else {
            DATA = { goals: [] };
        }
        render();
    }

    // --- MODALS & UI HELPERS ---

    function openModal(id, goalId = null) {
        const modal = document.getElementById(id);
        if (modal) {
            modal.classList.add('show');
            // –î–ª—è –º–æ–¥–∞–ª–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/–ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            if (goalId) {
                if (id === 'edit-modal') currentEditId = goalId;
                if (id === 'progress-modal') currentProgressId = goalId;
            }
        }
    }

    function closeModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
            modal.classList.remove('show');
            if (id === 'edit-modal') currentEditId = null;
            if (id === 'progress-modal') {
                currentProgressId = null;
                document.getElementById('progress-amount').value = '';
            }
        }
    }

    function openConfirmModal(text, onConfirm, goalId = null) {
        document.getElementById('confirm-text').textContent = text;
        confirmAction = () => {
            onConfirm(goalId);
            closeModal('confirm-modal');
        };
        openModal('confirm-modal');
    }

    document.getElementById('confirm-ok').onclick = () => {
        if (confirmAction) confirmAction();
    };
    document.getElementById('confirm-cancel').onclick = () => closeModal('confirm-modal');
    document.querySelectorAll('.modal-close').forEach(btn => {
        btn.onclick = (e) => closeModal(e.target.closest('.modal').id);
    });

    // --- DATA MANIPULATION ---

    function getGoals(filter) {
        switch(filter) {
            case 'active':
                return DATA.goals.filter(g => !g.done && !g.deleted).sort(sortGoals);
            case 'done':
                return DATA.goals.filter(g => g.done && !g.deleted).sort(sortGoals);
            case 'trash':
                return DATA.goals.filter(g => g.deleted).sort(sortGoals);
            case 'all':
            default:
                return DATA.goals.filter(g => !g.deleted).sort(sortGoals);
        }
    }
    
    function sortGoals(a, b) {
        const priorityOrder = { high: 1, med: 2, low: 3 };
        
        // 1. –°–Ω–∞—á–∞–ª–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
        const priorityA = priorityOrder[a.priority] || 4;
        const priorityB = priorityOrder[b.priority] || 4;
        if (priorityA !== priorityB) return priorityA - priorityB;

        // 2. –ó–∞—Ç–µ–º –ø–æ –¥–µ–¥–ª–∞–π–Ω—É (—Å–∞–º—ã–π –±–ª–∏–∑–∫–∏–π –≤ –Ω–∞—á–∞–ª–µ, –∏–ª–∏ null –≤ –∫–æ–Ω—Ü–µ)
        const dateA = a.deadline ? new Date(a.deadline).getTime() : Infinity;
        const dateB = b.deadline ? new Date(b.deadline).getTime() : Infinity;
        if (dateA !== dateB) return dateA - dateB;

        // 3. –ó–∞—Ç–µ–º –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (—Å–∞–º—ã–π –Ω–æ–≤—ã–π –≤ –∫–æ–Ω—Ü–µ, –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
        const createdA = new Date(a.created).getTime();
        const createdB = new Date(b.created).getTime();
        return createdA - createdB;
    }


    function addGoal(title, target, current, deadline, priority, notes) {
        const newGoal = {
            id: 'g_' + Date.now() + Math.random().toString(36).substring(2, 9),
            title: title || '–ù–æ–≤–∞—è —Ü–µ–ª—å',
            target: safeParseNum(target),
            current: safeParseNum(current),
            deadline: deadline || null,
            priority: priority || 'med',
            notes: notes || '',
            created: nowISO(),
            done: false,
            deleted: false
        };
        DATA.goals.push(newGoal);
        save();
        render();
        showToast('–¶–µ–ª—å "' + newGoal.title + '" –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        return newGoal;
    }

    function updateGoal(id, updates) {
        const goal = DATA.goals.find(g => g.id === id);
        if (goal) {
            Object.assign(goal, updates);
            // –ï—Å–ª–∏ —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞, —Å—Ç–∞–≤–∏–º done = true
            if (goal.current >= goal.target && !goal.done) {
                goal.done = true;
                showToast('–¶–µ–ª—å "' + goal.title + '" –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! üéâ');
            } else if (goal.current < goal.target && goal.done) {
                 // –ï—Å–ª–∏ —Ü–µ–ª—å –±—ã–ª–∞ "done", –Ω–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–∫–∞—Ç–∏–ª—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–µ –≤ active
                 goal.done = false;
            }
            save();
            render();
            return true;
        }
        return false;
    }
    
    // --- TEMPLATE LOGIC ---
    function setDeadlineByTemplate(deadlineInput, templateSelect, customDaysInput) {
        const template = templateSelect.value;
        const today = new Date();
        const customDaysField = customDaysInput.closest('.custom-days-field');

        // –°–±—Ä–æ—Å
        deadlineInput.value = '';
        customDaysField.style.display = 'none';

        if (template === 'custom') {
            customDaysField.style.display = 'flex';
            const days = parseInt(customDaysInput.value) || 0;
            if (days > 0) {
                const deadline = new Date(today);
                deadline.setDate(today.getDate() + days);
                deadlineInput.value = deadline.toISOString().split('T')[0];
            }
        } else if (template) {
            const days = parseInt(template);
            if (!isNaN(days) && days > 0) {
                const deadline = new Date(today);
                deadline.setDate(today.getDate() + days);
                deadlineInput.value = deadline.toISOString().split('T')[0];
            }
        }
    }
    
    // --- RENDER FUNCTIONS ---

    function getActiveFilter() {
        return document.querySelector('.tab.active').dataset.filter;
    }

    function render() {
        const filter = getActiveFilter();
        const filteredGoals = getGoals(filter);
        const list = document.getElementById('goals-list');
        list.innerHTML = '';
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
        document.getElementById('active-count').textContent = getGoals('active').length;
        document.getElementById('done-count').textContent = getGoals('done').length;
        document.getElementById('total-count').textContent = getGoals('active').length + getGoals('done').length;
        document.getElementById('trash-count').textContent = getGoals('trash').length;
        
        // –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å
        renderOverallProgress();
        
        // –†–µ–Ω–¥–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        if (filteredGoals.length === 0) {
            list.innerHTML = renderEmptyState(filter);
        } else {
            filteredGoals.forEach(goal => {
                list.appendChild(renderGoalCard(goal, filter));
            });
        }
        
        // –†–µ–Ω–¥–µ—Ä –ø–∞–Ω–µ–ª–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
        updateMultiActionBar(filter);
    }
    
    function renderOverallProgress() {
        const activeGoals = getGoals('active');
        let totalTarget = 0;
        let totalCurrent = 0;
        
        activeGoals.forEach(g => {
            totalTarget += g.target;
            totalCurrent += g.current;
        });

        const progressPercent = totalTarget > 0 ? Math.min(100, Math.round((totalCurrent / totalTarget) * 100)) : 0;
        
        const progressBar = document.getElementById('overall-progress');
        const progressText = document.getElementById('overall-text');

        progressBar.style.width = progressPercent + '%';
        progressText.innerHTML = `${progressPercent}% –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ (–¶–µ–ª—å: ${formatNumber(totalTarget)}, –ï—Å—Ç—å: ${formatNumber(totalCurrent)})`;
    }

    function renderEmptyState(filter) {
        let text = '–ü–æ–∫–∞ –ø—É—Å—Ç–æ.';
        let icon = 'fa-solid fa-face-smile';

        if (filter === 'done') {
            text = '–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π. –ü–æ—Ä–∞ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å!';
            icon = 'fa-solid fa-trophy';
        } else if (filter === 'trash') {
            text = '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –û—Ç–ª–∏—á–Ω–∞—è —á–∏—Å—Ç–æ—Ç–∞!';
            icon = 'fa-solid fa-hand-sparkles';
        } else if (filter === 'active' || filter === 'all') {
            text = '–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ü–µ–ª—å!';
            icon = 'fa-solid fa-rocket';
        }

        return `
            <div class="empty-message">
                <i class="${icon}" style="font-size: 32px; color: var(--accent);"></i>
                <p>${text}</p>
            </div>
        `;
    }

    function renderGoalCard(goal, filter) {
        const card = document.createElement('div');
        card.className = 'goal-card';
        card.dataset.id = goal.id;
        if (selectedGoalIds.has(goal.id)) {
            card.classList.add('selected');
        }

        const percent = goal.target > 0 ? Math.min(100, Math.round((goal.current / goal.target) * 100)) : 0;
        
        const isDone = goal.done;
        const isDeleted = goal.deleted;
        
        // Priority Badge
        const priorityIcon = goal.priority === 'high' ? 'fa-solid fa-fire' : 
                             goal.priority === 'med' ? 'fa-solid fa-star' : 
                             'fa-solid fa-leaf';
        const priorityText = goal.priority === 'high' ? '–í—ã—Å–æ–∫–∏–π' : 
                             goal.priority === 'med' ? '–°—Ä–µ–¥–Ω–∏–π' : 
                             '–ù–∏–∑–∫–∏–π';
        const priorityBadge = `<span class="priority-badge priority-${goal.priority}"><i class="${priorityIcon}"></i>${priorityText}</span>`;

        // Deadline
        let deadlineHtml = '';
        if (goal.deadline) {
            const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
            let timeText = `–î–µ–¥–ª–∞–π–Ω: <span>${goal.deadline}</span>`;
            
            if (isDone) {
                timeText = `–ó–∞–≤–µ—Ä—à–µ–Ω–∞`;
            } else if (daysLeft < 0) {
                timeText = `<span style="color: var(--red); font-weight: 700;">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ ${Math.abs(daysLeft)} –¥–Ω.</span>`;
            } else if (daysLeft <= 7) {
                timeText = `<span style="color: var(--orange); font-weight: 700;">–û—Å—Ç–∞–ª–æ—Å—å ${daysLeft} –¥–Ω.</span>`;
            } else {
                timeText = `–û—Å—Ç–∞–ª–æ—Å—å <span>${daysLeft} –¥–Ω.</span>`;
            }
            
            deadlineHtml = `<span title="–î–µ–¥–ª–∞–π–Ω"><i class="fa-regular fa-calendar-days"></i> ${timeText}</span>`;
        }

        // Notes Button
        const notesButton = goal.notes ? `<button class="action-icon-btn secondary" onclick="showToast('${goal.notes.replace(/'/g, "\\'")}', 6000)"><i class="fa-solid fa-note-sticky"></i> <span class="desktop-only">–ó–∞–º–µ—Ç–∫–∞</span></button>` : '';


        // Actions based on filter
        let actionsHtml = '';
        if (filter === 'trash') {
            // –î–µ–π—Å—Ç–≤–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ
            actionsHtml = `
                <button class="action-icon-btn secondary" data-action="restore"><i class="fa-solid fa-rotate-left"></i> <span class="desktop-only">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</span></button>
                <button class="action-icon-btn delete" data-action="final-delete"><i class="fa-solid fa-ban"></i> <span class="desktop-only">–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞</span></button>
            `;
        } else {
            // –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö/–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö
            actionsHtml = `
                ${notesButton}
                ${!isDone ? `<button class="action-icon-btn secondary" data-action="progress"><i class="fa-solid fa-arrow-up-right-dots"></i> <span class="desktop-only">–ë–∞–ª–∞–Ω—Å</span></button>` : ''}
                <button class="action-icon-btn secondary" data-action="edit"><i class="fa-solid fa-pen"></i> <span class="desktop-only">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span></button>
                <button class="action-icon-btn ${isDone ? 'secondary' : 'primary'}" data-action="${isDone ? 'undone' : 'done'}"><i class="fa-solid fa-${isDone ? 'arrow-rotate-left' : 'check'}"></i> <span class="desktop-only">${isDone ? '–í–µ—Ä–Ω—É—Ç—å' : '–ì–æ—Ç–æ–≤–æ'}</span></button>
                <button class="action-icon-btn delete" data-action="trash"><i class="fa-regular fa-trash-can"></i> <span class="desktop-only">–í –∫–æ—Ä–∑–∏–Ω—É</span></button>
            `;
        }
        
        card.innerHTML = `
            <div class="goal-checkbox-wrapper">
                <input type="checkbox" class="goal-select-checkbox" data-id="${goal.id}" ${selectedGoalIds.has(goal.id) ? 'checked' : ''}>
            </div>
            <div class="goal-card-content">
                <div class="goal-header">
                    <div class="goal-title">${goal.title}</div>
                    <div>${priorityBadge}</div>
                </div>
                
                <div class="goal-meta">
                    ${deadlineHtml}
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" style="width:${percent}%"></div>
                </div>
                <div class="numbers">
                    <span>${formatNumber(goal.current)}</span>
                    <span>/ ${formatNumber(goal.target)}</span>
                </div>
                <div class="actions-row">
                    ${actionsHtml}
                </div>
            </div>
        `;

        // Attach event listeners to the action buttons inside the card
        card.querySelectorAll('.action-icon-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–∞ —Å–∞–º–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
                const action = btn.dataset.action;
                handleGoalAction(goal.id, action);
            });
        });

        // Attach event listener for the selection checkbox
        const checkbox = card.querySelector('.goal-select-checkbox');
        checkbox.addEventListener('click', (e) => e.stopPropagation()); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–ø–ª—ã—Ç–∏–µ
        checkbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                selectedGoalIds.add(goal.id);
            } else {
                selectedGoalIds.delete(goal.id);
            }
            card.classList.toggle('selected', e.target.checked);
            updateMultiActionBar(filter);
        });
        
        // Attach event listener for card click to toggle selection (if not deleting/editing)
        card.addEventListener('click', (e) => {
             // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
            if (e.target.closest('.action-icon-btn')) return;
            
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
        });


        return card;
    }

    function handleGoalAction(id, action) {
        const goal = DATA.goals.find(g => g.id === id);
        if (!goal) return;

        switch (action) {
            case 'edit':
                populateEditModal(goal);
                openModal('edit-modal', id);
                break;
            case 'progress':
                openModal('progress-modal', id);
                document.getElementById('progress-amount').focus();
                break;
            case 'done':
                updateGoal(id, { done: true });
                break;
            case 'undone':
                updateGoal(id, { done: false });
                break;
            case 'trash':
                openConfirmModal(`–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ü–µ–ª—å "${goal.title}" –≤ –∫–æ—Ä–∑–∏–Ω—É?`, () => {
                    updateGoal(id, { deleted: true, done: false });
                    showToast(`–¶–µ–ª—å "${goal.title}" –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É`);
                }, id);
                break;
            case 'restore':
                openConfirmModal(`–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–ª—å "${goal.title}"?`, () => {
                    updateGoal(id, { deleted: false, done: false });
                    showToast(`–¶–µ–ª—å "${goal.title}" –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`);
                }, id);
                break;
            case 'final-delete':
                 openConfirmModal(`–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å "${goal.title}" –ù–ê–í–°–ï–ì–î–ê? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.`, () => {
                    DATA.goals = DATA.goals.filter(g => g.id !== id);
                    save();
                    render();
                    showToast(`–¶–µ–ª—å "${goal.title}" —É–¥–∞–ª–µ–Ω–∞ –Ω–∞–≤—Å–µ–≥–¥–∞`);
                }, id);
                break;
        }
    }
    
    // --- MULTI-SELECT ACTIONS ---

    function updateMultiActionBar(filter) {
        const count = selectedGoalIds.size;
        multiActionText.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${count}`;
        multiActionBar.style.display = count > 0 ? 'flex' : 'none';
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∫–ª–∞–¥–∫–∏
        const multiActionBtnsContainer = multiActionBar.querySelector('.multi-action-btns');
        multiActionBtnsContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
        
        if (filter === 'trash') {
            multiActionBtnsContainer.appendChild(btnMultiRestore);
            multiActionBtnsContainer.appendChild(btnMultiFinalDelete);
        } else {
            multiActionBtnsContainer.appendChild(btnMultiDone);
            multiActionBtnsContainer.appendChild(btnMultiTrash);
        }
         // –ö–Ω–æ–ø–∫–∞ "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ" –≤—Å–µ–≥–¥–∞ —Å–ª–µ–≤–∞ (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
        multiActionBtnsContainer.prepend(btnSelectAll);
    }
    
    function applyMultiAction(action) {
        if (selectedGoalIds.size === 0) return;
        
        selectedGoalIds.forEach(id => {
            const goal = DATA.goals.find(g => g.id === id);
            if (!goal) return;
            
            switch(action) {
                case 'done':
                    updateGoal(id, { done: true });
                    break;
                case 'trash':
                    updateGoal(id, { deleted: true, done: false });
                    break;
                case 'restore':
                    updateGoal(id, { deleted: false, done: false });
                    break;
                case 'final-delete':
                    DATA.goals = DATA.goals.filter(g => g.id !== id);
                    break;
            }
        });

        const actionText = action === 'done' ? '–∑–∞–≤–µ—Ä—à–µ–Ω–æ' : 
                           action === 'trash' ? '–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É' : 
                           action === 'restore' ? '–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ' : '—É–¥–∞–ª–µ–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞';
        
        showToast(`${selectedGoalIds.size} —Ü–µ–ª–µ–π ${actionText}.`);
        selectedGoalIds.clear(); // –°–±—Ä–æ—Å
        save();
        render(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    }


    // --- MODAL DATA HANDLERS ---
    
    function populateEditModal(goal) {
        document.getElementById('edit-title').value = goal.title;
        document.getElementById('edit-target').value = formatNumber(goal.target);
        document.getElementById('edit-current').value = formatNumber(goal.current);
        document.getElementById('edit-deadline').value = goal.deadline || '';
        document.getElementById('edit-priority').value = goal.priority;
        document.getElementById('edit-notes').value = goal.notes;
        
        // –°–±—Ä–æ—Å –ø–æ–ª—è —à–∞–±–ª–æ–Ω–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        document.getElementById('edit-template').value = '';
        document.getElementById('edit-custom-days-field').style.display = 'none';
        document.getElementById('edit-custom-days-input').value = '';
    }

    // --- EVENT LISTENERS ---

    // 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ü–µ–ª–∏
    document.getElementById('btn-add').onclick = () => {
        const title = document.getElementById('g-title').value || '–ù–æ–≤–∞—è —Ü–µ–ª—å';
        const target = document.getElementById('g-target').value;
        const current = document.getElementById('g-current').value;
        const deadline = document.getElementById('g-deadline').value;
        const priority = document.getElementById('g-priority').value;
        const notes = document.getElementById('g-notes').value;

        if (safeParseNum(target) <= 0) {
            showToast('–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0!');
            return;
        }

        addGoal(title, target, current, deadline, priority, notes);

        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('g-title').value = '';
        document.getElementById('g-target').value = '';
        document.getElementById('g-current').value = '';
        document.getElementById('g-deadline').value = '';
        document.getElementById('g-priority').value = 'med';
        document.getElementById('g-notes').value = '';
        document.getElementById('g-template').value = '';
        document.getElementById('g-custom-days-field').style.display = 'none';
        document.getElementById('g-custom-days-input').value = '';
    };
    
    // 2. –®–∞–±–ª–æ–Ω —Å—Ä–æ–∫–∞ (Create)
    const gTemplate = document.getElementById('g-template');
    const gCustomDays = document.getElementById('g-custom-days-input');
    const gDeadline = document.getElementById('g-deadline');
    
    gTemplate.onchange = () => setDeadlineByTemplate(gDeadline, gTemplate, gCustomDays);
    gCustomDays.oninput = () => setDeadlineByTemplate(gDeadline, gTemplate, gCustomDays);
    
    // 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    document.getElementById('save-edit').onclick = () => {
        if (!currentEditId) return;

        const goal = DATA.goals.find(g => g.id === currentEditId);
        if (!goal) return;
        
        const targetValue = safeParseNum(document.getElementById('edit-target').value);
        if (targetValue <= 0) {
            showToast('–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0!');
            return;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞ —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –≤—ã–±—Ä–∞–Ω
        const editTemplate = document.getElementById('edit-template');
        const editCustomDays = document.getElementById('edit-custom-days-input');
        const editDeadline = document.getElementById('edit-deadline');

        if (editTemplate.value) {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ª–æ–≥–∏–∫—É —à–∞–±–ª–æ–Ω–∞
            setDeadlineByTemplate(editDeadline, editTemplate, editCustomDays);
        }

        updateGoal(currentEditId, {
            title: document.getElementById('edit-title').value,
            target: targetValue,
            current: safeParseNum(document.getElementById('edit-current').value),
            deadline: editDeadline.value || null,
            priority: document.getElementById('edit-priority').value,
            notes: document.getElementById('edit-notes').value
        });
        closeModal('edit-modal');
        showToast('–¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
    };
    
    // 4. –®–∞–±–ª–æ–Ω —Å—Ä–æ–∫–∞ (Edit)
    const editTemplate = document.getElementById('edit-template');
    const editCustomDays = document.getElementById('edit-custom-days-input');
    const editDeadline = document.getElementById('edit-deadline');
    
    editTemplate.onchange = () => setDeadlineByTemplate(editDeadline, editTemplate, editCustomDays);
    editCustomDays.oninput = () => setDeadlineByTemplate(editDeadline, editTemplate, editCustomDays);

    // 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    document.getElementById('btn-add-progress').onclick = () => handleProgressUpdate('add');
    document.getElementById('btn-subtract').onclick = () => handleProgressUpdate('subtract');
    
    function handleProgressUpdate(type) {
        if (!currentProgressId) return;
        const goal = DATA.goals.find(g => g.id === currentProgressId);
        if (!goal) return;

        const amount = safeParseNum(document.getElementById('progress-amount').value);
        if (amount <= 0) {
            showToast('–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0!');
            return;
        }
        
        let newCurrent;
        if (type === 'add') {
            newCurrent = goal.current + amount;
            showToast(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${formatNumber(amount)} –∫ "${goal.title}"`);
        } else {
            newCurrent = Math.max(0, goal.current - amount); // –ù–µ —É—Ö–æ–¥–∏–º –≤ –º–∏–Ω—É—Å
            showToast(`–í—ã—á—Ç–µ–Ω–æ ${formatNumber(amount)} –∏–∑ "${goal.title}"`);
        }
        
        updateGoal(currentProgressId, { current: newCurrent });
        closeModal('progress-modal');
    }
    
    // 6. –ö–Ω–æ–ø–∫–∞ –î–ï–ú–û
    document.getElementById('btn-demo').onclick = () => {
        openConfirmModal('–î–æ–±–∞–≤–∏—Ç—å 3 –¥–µ–º–æ-—Ü–µ–ª–∏? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞—é—Ç.', () => {
            addGoal('–ù–∞–∫–æ–ø–∏—Ç—å –Ω–∞ –æ—Ç–ø—É—Å–∫', '150–∫', '50–∫', '2026-06-01', 'high', '–ù–∞—á–∞—Ç—å –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –ø–æ 10 —Ç—ã—Å. –≤ –º–µ—Å—è—Ü.');
            addGoal('–ò–∑—É—á–∏—Ç—å Python', '50', '20', null, 'med', '–ü—Ä–æ–π—Ç–∏ –∫—É—Ä—Å "Python –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö" (50 —É—Ä–æ–∫–æ–≤).');
            addGoal('–ö—É–ø–∏—Ç—å –Ω–æ–≤—É—é –∫–∞–º–µ—Ä—É', '80000', '80000', '2025-05-20', 'low', '–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞, –∂–¥—É –¥–æ—Å—Ç–∞–≤–∫—É.');
            
            // –û—Ç–º–µ—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
            DATA.goals[DATA.goals.length - 1].done = true;
            save();
            render();
            showToast('–î–µ–º–æ-—Ü–µ–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
        });
    };
    
    // 7. –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç
    document.getElementById('export-btn').onclick = () => {
        const dataStr = JSON.stringify(DATA, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `designFlow_goals_backup_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        showToast('–ë–∞–∑–∞ —Å–∫–∞—á–∞–Ω–∞');
    };

    document.getElementById('import-btn').onclick = () => {
        document.getElementById('file-import').click();
    };

    document.getElementById('file-import').onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç JSON
                JSON.parse(reader.result); 
                openConfirmModal('–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ? –¢–µ–∫—É—â–∏–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã!', () => {
                    localStorage.setItem(K, reader.result);
                    load();
                    showToast('–ë–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                });
            } catch(err) {
                showToast('–û—à–∏–±–∫–∞: –§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è JSON.');
            }
        };
        reader.readAsText(file);
        e.target.value = '';
    };

    // 8. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            selectedGoalIds.clear(); // –°–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∫–ª–∞–¥–∫–∏
            render();
        };
    });

    // 9. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    function toggleTheme() {
        const currentTheme = document.body.dataset.theme;
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.body.dataset.theme = newTheme;
        localStorage.setItem(THEME_K, newTheme); // –ò–°–ü–û–õ–¨–ó–£–ï–ú –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏
        const icon = document.querySelector('#theme-btn i');
        if (icon) {
            icon.className = newTheme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        }
    }
    document.getElementById('theme-btn').onclick = toggleTheme;

    // 10. Multi-select buttons
    btnSelectAll.onclick = () => {
        const filter = getActiveFilter();
        const filteredGoalIds = getGoals(filter).map(g => g.id);
        
        if (selectedGoalIds.size === filteredGoalIds.length && filteredGoalIds.length > 0) {
            // –ï—Å–ª–∏ –≤—Å–µ –≤—ã–±—Ä–∞–Ω—ã, —Å–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            selectedGoalIds.clear();
        } else {
            // –ò–Ω–∞—á–µ –≤—ã–±—Ä–∞—Ç—å –≤—Å–µ
            selectedGoalIds = new Set(filteredGoalIds);
        }
        render();
    };
    
    btnMultiDone.onclick = () => openConfirmModal(`–ó–∞–≤–µ—Ä—à–∏—Ç—å ${selectedGoalIds.size} —Ü–µ–ª–µ–π?`, () => applyMultiAction('done'));
    btnMultiTrash.onclick = () => openConfirmModal(`–û—Ç–ø—Ä–∞–≤–∏—Ç—å ${selectedGoalIds.size} —Ü–µ–ª–µ–π –≤ –∫–æ—Ä–∑–∏–Ω—É?`, () => applyMultiAction('trash'));
    btnMultiRestore.onclick = () => openConfirmModal(`–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ${selectedGoalIds.size} —Ü–µ–ª–µ–π?`, () => applyMultiAction('restore'));
    btnMultiFinalDelete.onclick = () => openConfirmModal(`–£–¥–∞–ª–∏—Ç—å ${selectedGoalIds.size} —Ü–µ–ª–µ–π –ù–ê–í–°–ï–ì–î–ê?`, () => applyMultiAction('final-delete'));


    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–µ–º—ã) ---
    
    function init() {
        // 1. –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
        const savedTheme = localStorage.getItem(THEME_K) || ''; // –ò–°–ü–û–õ–¨–ó–£–ï–ú –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß
        document.body.dataset.theme = savedTheme;
        
        // 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –Ω–∞ –∫–Ω–æ–ø–∫–µ —Ç–µ–º—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
        const isDark = savedTheme === 'dark';
        const themeButtonIcon = document.querySelector('#theme-btn i');
        if (themeButtonIcon) {
            themeButtonIcon.className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        }

        // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        load();
    }
    
    init();

})();
</script>
</body>
</html>
